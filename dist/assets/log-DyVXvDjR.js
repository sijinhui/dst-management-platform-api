import{u as ae,a as se,g as ne,c as B,r as u,o as ue,e as re,w as ie,J as d,K as de,f as s,q as v,a1 as ce,m as i,n as N,l as m,j as r,p as A,t as p,i as c,v as g,F as S,x as U,s as ve,I as me}from"./index-CnGsCQVR.js";import{s as pe}from"./index-DIHJNAwJ.js";import{l as T}from"./index-DdQKjJiA.js";const ge={class:"card-header"},he={key:0,class:"fcc"},fe={key:0,style:{"font-weight":"lighter","font-size":"smaller"}},we={style:{"font-weight":"lighter","font-size":"smaller"}},ye={key:1,class:"fcc"},_e={key:0,style:{"font-weight":"lighter","font-size":"smaller"}},Ve={style:{"font-weight":"lighter","font-size":"smaller"}},Ce={class:"card-footer"},De={__name:"log",props:{type:String,historical:Boolean},setup(G,{expose:J}){var W,$,R;const t=G,{t:w}=ae(),{isMobile:I}=se(),o=ne(),K=B(()=>o.isDark),k=B(()=>o.language),y=u(null),P=()=>{me(()=>{y.value&&y.value.scrollToBottom&&y.value.scrollToBottom()})};ue(()=>{t.historical?H():(O(),M()),_.value=window.innerHeight,window.addEventListener("resize",()=>{_.value=window.innerHeight})});const O=()=>{var a,l;!o.dstClusters||!o.selectedDstCluster||(n.value.worldName=((l=(a=o.dstClusters.find(f=>f.clusterName===o.selectedDstCluster))==null?void 0:a.worlds)==null?void 0:l[0])??null)},_=u(0),b=u(!1),q=B(()=>b.value?n.value.line:I.value?Math.floor(_.value*.55/21)-1:Math.floor(_.value*.67/21)-1),D=u(1),n=u({line:q.value,type:t.type,clusterName:o.selectedDstCluster,worldName:null}),h=u(""),E=()=>{!n.value.worldName&&n.value.type!=="runtime"&&n.value.type!=="access"||T.logValue.get(n.value).then(a=>{a.data!==null&&(h.value=a.data.join(`
`),P())})};let V=null;const M=()=>{V=setInterval(()=>{D.value===1&&E()},2e3)},x=()=>{V&&(clearInterval(V),V=null)},j=u([]),C=u(""),F=u({clusterName:o.selectedDstCluster,worldName:((R=($=(W=o.dstClusters)==null?void 0:W.find(a=>a.clusterName===o.selectedDstCluster))==null?void 0:$.worlds)==null?void 0:R[0])??null,type:t.type}),H=()=>{T.historical.logFile.get(F.value).then(a=>{j.value=a.data})},L=u(!1),Q=()=>{H(),C.value=""},X=()=>{L.value=!0;const a={file:C.value};T.historical.log.get(a).then(l=>{h.value=l.data,P()}).finally(()=>{L.value=!1})};return re(()=>{x(),window.removeEventListener("beforeunload",x)}),J({cancelRequests:x,startRequests:M}),ie([q,b],([a,l])=>{l||(n.value.line=a)},{immediate:!0}),(a,l)=>{const f=d("el-option"),z=d("el-select"),Y=d("el-switch"),Z=d("el-input-number"),ee=d("el-button"),le=d("el-tooltip"),te=d("el-card"),oe=de("loading");return s(),v(te,{shadow:"never"},ce({header:i(()=>[N("div",ge,[A(p(r(w)("logs.logs"))+" ",1),t.historical?(s(),c("div",he,[t.type==="world"||t.type==="chat"?(s(),c("span",fe,p(k.value==="zh"?"世界选择":"World")+"：",1)):g("",!0),t.type==="world"||t.type==="chat"?(s(),v(z,{key:1,modelValue:F.value.worldName,"onUpdate:modelValue":l[0]||(l[0]=e=>F.value.worldName=e),onChange:Q,style:{width:"10vw","margin-right":"10px","font-weight":"lighter"}},{default:i(()=>[(s(!0),c(S,null,U(r(o).dstClusters.find(e=>e.clusterName===r(o).selectedDstCluster).worlds,e=>(s(),v(f,{label:e,value:e},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])):g("",!0),N("span",we,p(k.value==="zh"?"日志文件":"File")+"：",1),m(z,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value=e),size:"default",style:{width:"15vw","font-weight":"lighter"},onChange:X},{default:i(()=>[(s(!0),c(S,null,U(j.value,e=>(s(),v(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):g("",!0),t.historical?g("",!0):(s(),c("div",ye,[t.type==="world"||t.type==="chat"?(s(),c("span",_e,p(k.value==="zh"?"世界选择":"World")+"：",1)):g("",!0),t.type==="world"||t.type==="chat"?(s(),v(z,{key:1,modelValue:n.value.worldName,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.worldName=e),onChange:l[3]||(l[3]=e=>h.value=""),style:{width:"10vw","margin-right":"10px","font-weight":"lighter"}},{default:i(()=>[(s(!0),c(S,null,U(r(o).dstClusters.find(e=>e.clusterName===r(o).selectedDstCluster).worlds,e=>(s(),v(f,{label:e,value:e},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])):g("",!0),N("span",Ve,p(r(w)("logs.autoPull")),1),m(Y,{modelValue:D.value,"onUpdate:modelValue":l[4]||(l[4]=e=>D.value=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]))])]),default:i(()=>[ve(m(pe,{ref_key:"editor",ref:y,modelValue:h.value,"onUpdate:modelValue":l[5]||(l[5]=e=>h.value=e),height:r(I)?"55vh":"67vh",theme:K.value?"darcula":"idea",mode:"javascript",style:{width:"100%"}},null,8,["modelValue","height","theme"]),[[oe,L.value]])]),_:2},[t.historical?void 0:{name:"footer",fn:i(()=>[N("div",Ce,[m(Z,{modelValue:n.value.line,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.line=e),"controls-position":"right",onFocus:l[7]||(l[7]=e=>b.value=!0),style:{width:"100px"}},null,8,["modelValue"]),m(le,{content:r(w)("logs.manualPullTips"),effect:"light",placement:"top"},{default:i(()=>[m(ee,{style:{"margin-left":"10px"},type:"primary",onClick:E},{default:i(()=>[A(p(r(w)("logs.manualPull")),1)]),_:1})]),_:1},8,["content"])])]),key:"0"}]),1024)}}};export{De as default};
