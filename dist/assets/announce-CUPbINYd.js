import{u as X,a as Y,g as Z,D as ee,G as ne,d as oe,H as le,c as S,o as te,r as _,w as ae,I as w,J as u,f as v,i as se,l as o,m as l,n as q,p as d,t as i,j as r,q as V,$ as ue,A as re,B as N,E as ce,C as ie}from"./index-CnGsCQVR.js";import{t as A}from"./index-BNnN41-c.js";const de={class:"page-div"},me={class:"card-header"},pe={class:"el-form-item-msg"},fe={class:"dialog-footer"},be=ue({name:"toolsAnnounce"}),ye=Object.assign(be,{setup(_e){const{t}=X(),{isMobile:C}=Y(),m=Z(),g=ee();ne();const B=oe(),F=le("refresh");S(()=>m.isDark),S(()=>m.language),te(()=>{y()});const $=_([]),y=()=>{const n={clusterName:m.selectedDstCluster};A.announce.get(n).then(e=>{$.value=e.data})},k=_(""),T=()=>{s.value={name:"",enable:!0,content:"",frequency:600},w(()=>{f.value.clearValidate()}),k.value="post",p.value=!0},p=_(!1),f=_(),s=_({name:"",enable:!0,content:"",frequency:600}),E={name:[{required:!0,message:t("tools.announce.rules.name"),trigger:"blur"}],enable:[{required:!0,message:t("tools.announce.rules.enable"),trigger:"change"}],content:[{required:!0,message:t("tools.announce.rules.content"),trigger:"blur"}],frequency:[{required:!0,message:t("tools.announce.rules.frequency"),trigger:"blur"}]},R=()=>{if(s.value.frequency<1){re(t("tools.announce.rules.frequencyMin"));return}switch(k.value){case"post":U();break;case"put":j();break}},U=()=>{f.value.validate(n=>{if(n){const e={clusterName:m.selectedDstCluster,autoAnnounce:s.value};A.announce.post(e).then(c=>{p.value=!1,N(c.message),y()})}})},z=n=>{ce.confirm(t("tools.announce.deleteTip"),"Warning",{confirmButtonText:t("tools.announce.confirm"),cancelButtonText:t("tools.announce.cancel"),type:"warning"}).then(()=>{const e={clusterName:m.selectedDstCluster,autoAnnounce:n};A.announce.delete(e).then(c=>{N(c.message),y()})}).catch(()=>{ie(t("home.canceled"))})},K=n=>{s.value=n,w(()=>{f.value.clearValidate()}),k.value="put",p.value=!0},j=()=>{f.value.validate(n=>{if(n){const e={clusterName:m.selectedDstCluster,autoAnnounce:s.value};A.announce.put(e).then(c=>{p.value=!1,N(c.message),y()})}})},I=()=>{setTimeout(()=>{g.meta.isKeepAlive&&B.removeKeepAliveName(g.name),F(!1),w(()=>{g.meta.isKeepAlive&&B.addKeepAliveName(g.name),F(!0)})},0)};return ae(()=>m.selectedDstCluster,n=>{n&&w(()=>{I()})},{immediate:!1}),(n,e)=>{const c=u("el-button"),b=u("el-table-column"),M=u("el-tag"),P=u("el-table"),G=u("el-result"),H=u("el-card"),J=u("el-col"),O=u("el-row"),D=u("el-input"),h=u("el-form-item"),W=u("el-switch"),x=u("el-form"),L=u("el-dialog");return v(),se("div",de,[o(O,{gutter:10},{default:l(()=>[o(J,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:l(()=>[o(H,{style:{"min-height":"70vh"},shadow:"never"},{header:l(()=>[q("div",me,[d(i(r(t)("tools.announce.title"))+" ",1),q("div",null,[o(c,{size:"default",type:"success",onClick:T},{default:l(()=>[d(i(r(t)("tools.announce.new")),1)]),_:1})])])]),default:l(()=>[$.value.length>0?(v(),V(P,{key:0,data:$.value,border:"",size:"small",style:{width:"100%"},"tooltip-effect":"light"},{default:l(()=>[o(b,{label:n.$t("tools.announce.name"),prop:"name"},null,8,["label"]),o(b,{label:n.$t("tools.announce.isEnable"),prop:"enable"},{default:l(a=>[a.row.enable?(v(),V(M,{key:0,type:"success"},{default:l(()=>[d(i(r(t)("tools.announce.enable")),1)]),_:1})):(v(),V(M,{key:1,type:"danger"},{default:l(()=>[d(i(r(t)("tools.announce.disable")),1)]),_:1}))]),_:1},8,["label"]),o(b,{label:n.$t("tools.announce.frequency"),prop:"frequency"},{default:l(a=>e[6]||(e[6]=[])),_:1},8,["label"]),o(b,{label:n.$t("tools.announce.content"),prop:"content","show-overflow-tooltip":""},{default:l(a=>e[7]||(e[7]=[])),_:1},8,["label"]),o(b,{label:n.$t("tools.announce.actions"),fixed:"right",prop:"actions",width:"140"},{default:l(a=>[o(c,{link:"",type:"primary",onClick:Q=>K(a.row)},{default:l(()=>[d(i(r(t)("tools.announce.update")),1)]),_:2},1032,["onClick"]),o(c,{link:"",type:"danger",onClick:Q=>z(a.row)},{default:l(()=>[d(i(r(t)("tools.announce.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])):(v(),V(G,{key:1,title:n.$t("tools.announce.noData"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1})]),_:1}),o(L,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),"close-on-click-modal":!1,title:n.$t("tools.announce.new"),width:"60%"},{footer:l(()=>[q("div",fe,[o(c,{onClick:e[4]||(e[4]=a=>p.value=!1)},{default:l(()=>[d(i(r(t)("tools.announce.cancel")),1)]),_:1}),o(c,{type:"primary",onClick:R},{default:l(()=>[d(i(r(t)("tools.announce.submit")),1)]),_:1})])]),default:l(()=>[o(x,{ref_key:"announceFormRef",ref:f,"label-position":r(C)?"top":"left","label-width":r(C)?"70":"auto",model:s.value,rules:E,size:r(C)?"small":"large"},{default:l(()=>[o(h,{label:n.$t("tools.announce.name"),prop:"name"},{default:l(()=>[o(D,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.name=a),disabled:k.value==="put"},null,8,["modelValue","disabled"])]),_:1},8,["label"]),o(h,{label:n.$t("tools.announce.isEnable"),prop:"enable"},{default:l(()=>[o(W,{modelValue:s.value.enable,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.enable=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(h,{label:n.$t("tools.announce.content"),prop:"content"},{default:l(()=>[o(D,{modelValue:s.value.content,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.content=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(h,{label:n.$t("tools.announce.frequency"),prop:"frequency"},{default:l(()=>[o(D,{modelValue:s.value.frequency,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.frequency=a),modelModifiers:{number:!0},min:1,step:1},null,8,["modelValue"]),q("div",pe,i(r(t)("tools.announce.frequencyTip")),1)]),_:1},8,["label"])]),_:1},8,["label-position","label-width","model","size"])]),_:1},8,["modelValue","title"])])}}});export{ye as default};
