import{t as w}from"./index-BNnN41-c.js";import{_ as de,u as pe,a as me,g as fe,D as _e,G as ge,d as he,H as ve,c as q,o as be,r as p,w as ke,I as A,J as s,K as we,f as P,i as ye,l as e,m as t,n as g,p as f,t as r,j as n,s as De,q as xe,a4 as Be,$ as Ce,A as I,E,B as D,C as N,ak as ze}from"./index-CnGsCQVR.js";import{f as Te}from"./tools-CmP39zM0.js";const Fe={class:"page-div"},Ie={class:"card-header"},Ee={class:"fcc"},Ne={class:"el-upload__text"},Se={class:"el-upload__tip"},Le=Ce({name:"toolsBackup"}),Re=Object.assign(Le,{setup($e){const{t:l}=pe(),{isMobile:V}=me(),i=fe(),x=_e();ge();const S=he(),L=ve("refresh");q(()=>i.isDark);const u=q(()=>i.language);be(()=>{v()}),p(!1),p(!1);const R=p([]);p({enable:!1,time:"00:00:00"});const $=p(0),v=()=>{const o={clusterName:i.selectedDstCluster};w.backup.get(o).then(a=>{R.value=a.data.backupFiles,$.value=a.data.diskUsage})},U=o=>{E.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(a,c,d)=>{if(a==="confirm"){c.confirmButtonLoading=!0;const _={clusterName:i.selectedDstCluster,name:o.name};w.backup.delete(_).then(h=>{D(h.message),d()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1,v()})}else d()}}).then(()=>{}).catch(()=>{N(l("home.canceled"))}).finally(()=>{b.value=!1})},K=o=>{E.confirm(u.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(a,c,d)=>{if(a==="confirm"){c.confirmButtonLoading=!0;const _={clusterName:i.selectedDstCluster,name:o.name};w.backupRestore.post(_).then(h=>{D(h.message),d()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1,v()})}else d()}}).then(()=>{}).catch(()=>{N(l("home.canceled"))}).finally(()=>{b.value=!1})},j=()=>{if(C.value.length===0){I(l("tools.backup.deleteTip"));return}E.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(o,a,c)=>{if(o==="confirm"){a.confirmButtonLoading=!0;const d={clusterName:i.selectedDstCluster,names:[]};for(let _ of C.value)d.names.push(_.name);w.multiDelete.delete(d).then(_=>{D(_.message),c()}).catch(()=>{}).finally(()=>{a.confirmButtonLoading=!1,v()})}else c()}}).then(()=>{}).catch(()=>{N(l("home.canceled"))})},O=p(),C=p([]),Q=o=>{C.value=o},G=o=>{let a=`/v1/download/backup/${i.selectedDstCluster}/${o.name}?authorization=${ze()}&&clusterName=${i.selectedDstCluster}&&lang=${i.language}`;window.open(a,"_blank"),b.value=!1},b=p(!1),H=o=>{let a=o.cmd,c=o.row;switch(b.value=!0,a){case"download":G(c);break;case"restore":K(c);break;case"delete":U(c);break;default:b.value=!1,I("error")}},z=p(!1),J=()=>{z.value=!0;const o={clusterName:i.selectedDstCluster};w.backup.post(o).then(a=>{D(a.message)}).finally(()=>{z.value=!1,v()})},k=p(!1),B=p(!1),T=p(),W=()=>{T.value&&T.value.clearFiles(),B.value=!0},X=o=>/\.tgz$/i.test(o.name)?!0:(I(u.value==="zh"?"请上传tgz文件":"Please upload a tgz file"),!1),Y=o=>{k.value=!0;const a=new FormData;a.append("file",o.file),a.append("clusterName",i.selectedDstCluster),w.backupImport.post(a).then(c=>{v(),D(c.message)}).finally(()=>{B.value=!1,k.value=!1})},Z=()=>{setTimeout(()=>{x.meta.isKeepAlive&&S.removeKeepAliveName(x.name),L(!1),A(()=>{x.meta.isKeepAlive&&S.addKeepAliveName(x.name),L(!0)})},0)};return ke(()=>i.selectedDstCluster,o=>{o&&A(()=>{Z()})},{immediate:!1}),(o,a)=>{const c=s("QuestionFilled"),d=s("el-icon"),_=s("el-tooltip"),h=s("el-button"),ee=s("el-progress"),y=s("el-table-column"),te=s("el-tag"),oe=s("arrow-down"),F=s("el-dropdown-item"),ae=s("el-dropdown-menu"),le=s("el-dropdown"),ne=s("el-table"),M=s("el-row"),se=s("el-card"),ce=s("el-col"),re=s("el-upload"),ue=s("el-dialog"),ie=we("loading");return P(),ye("div",Fe,[e(M,{gutter:10},{default:t(()=>[e(ce,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:t(()=>[e(se,{style:{"min-height":"70vh"},shadow:"never"},{header:t(()=>[g("div",Ie,[f(r(n(l)("tools.backup.title2"))+" ",1),g("div",null,[e(h,{type:"warning",onClick:W},{default:t(()=>[g("div",Ee,[f(r(n(l)("tools.backup.ImportBackup"))+" ",1),e(_,{content:n(l)("tools.backup.ImportBackupTip"),effect:"light",placement:"top"},{default:t(()=>[e(d,{size:"14",style:{"margin-left":"2px"}},{default:t(()=>[e(c)]),_:1})]),_:1},8,["content"])])]),_:1}),e(h,{loading:z.value,type:"primary",onClick:J},{default:t(()=>[f(r(n(l)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"]),e(h,{type:"danger",onClick:j},{default:t(()=>[f(r(n(l)("tools.backup.multiDelete")),1)]),_:1})])])]),default:t(()=>[g("div",null,[e(ee,{"stroke-width":"20","text-inside":"",style:{"margin-bottom":"20px"},percentage:parseFloat($.value.toFixed(1))},{default:t(({percentage:m})=>[g("span",null,r(n(l)("tools.backup.processBar"))+r(m)+"%",1)]),_:1},8,["percentage"])]),g("div",null,[e(M,null,{default:t(()=>[e(ne,{ref_key:"tableRef",ref:O,data:R.value,"max-height":n(V)?450:550,border:"",onSelectionChange:Q},{default:t(()=>[e(y,{fixed:"left",type:"selection",width:"55"}),e(y,{label:n(l)("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),e(y,{label:n(l)("tools.backup.cycles"),prop:"cycles"},{default:t(m=>[e(te,{type:"info"},{default:t(()=>[f(r(m.row.cycles),1)]),_:2},1024)]),_:1},8,["label"]),e(y,{label:n(l)("tools.backup.size"),prop:"size"},{default:t(m=>[f(r(n(Te)(m.row.size)),1)]),_:1},8,["label"]),e(y,{label:n(l)("setting.button.actions"),prop:"actions",width:"120px"},{default:t(m=>[e(le,{trigger:"click",onCommand:H},{dropdown:t(()=>[e(ae,null,{default:t(()=>[e(F,{command:{cmd:"download",row:m.row}},{default:t(()=>[f(r(n(l)("tools.backup.download")),1)]),_:2},1032,["command"]),e(F,{command:{cmd:"restore",row:m.row}},{default:t(()=>[f(r(n(l)("tools.backup.restore")),1)]),_:2},1032,["command"]),e(F,{command:{cmd:"delete",row:m.row}},{default:t(()=>[f(r(n(l)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:t(()=>[e(h,{loading:b.value,link:"",type:"primary"},{default:t(()=>[f(r(n(l)("setting.button.actions"))+" ",1),e(d,{class:"el-icon--right"},{default:t(()=>[e(oe)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1})]),_:1})]),_:1}),e(ue,{modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=m=>B.value=m),"close-on-click-modal":!k.value,"close-on-press-escape":!k.value,"show-close":!k.value,title:n(l)("tools.backup.ImportDialog.title"),width:"45%"},{default:t(()=>[De((P(),xe(re,{ref_key:"uploadRef",ref:T,"before-upload":X,"http-request":Y,limit:1,drag:""},{tip:t(()=>[g("div",Se,r(n(l)("tools.backup.ImportDialog.tip")),1)]),default:t(()=>[e(d,{class:"el-icon--upload"},{default:t(()=>[e(n(Be))]),_:1}),g("div",Ne,[f(r(n(l)("tools.backup.ImportDialog.text1"))+" ",1),g("em",null,r(n(l)("tools.backup.ImportDialog.text2")),1)])]),_:1})),[[ie,k.value]])]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close","title"])])}}}),Pe=de(Re,[["__scopeId","data-v-7f5af2c1"]]);export{Pe as default};
