import{o as de,g as me,c as I,b as ce,u as pe,a as _e,r as V,Q as z,J as n,f as m,i as j,l,m as e,n as c,t as u,j as a,p,q as _,v as g,F as ve,x as fe,$ as be,B as N,E as ge,C as he}from"./index-CnGsCQVR.js";import{d as O,S as B}from"./tools-CmP39zM0.js";import{S as we}from"./index-_xIMJ1eH.js";import{E as ye}from"./index-MwuyqoHq.js";const xe={class:"page-div"},Ce={class:"card-header"},ke={class:"tip"},Ve={style:{"margin-top":"5px"}},Pe={style:{"margin-top":"5px"}},Ue={class:"tip"},ze={class:"tip"},De={class:"tip_error"},Se={style:{display:"flex","align-items":"center"}},We={class:"el-form-item-msg"},Fe={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Ee=be({name:"Users"}),Te=Object.assign(Ee,{setup(Ne){de(()=>{P()});const D=me(),d=I(()=>D.language),Q=I(()=>D.isDark),R=ce(),{t:o}=pe(),{isMobile:y}=_e(),S=R.userInfo,M=V([]),P=()=>{z.userList.get().then(i=>{M.value=i.data})},Y=i=>{if(i.type==="update"){H(O(i.data));return}i.type==="delete"&&K(O(i.data))},w=V(),t=V({username:"",nickname:"",password:"",disabled:!1,role:"Non-admin",clusterPermission:null,clusterCreationProhibited:!1,maxWorldsPerCluster:2}),$={username:[{required:!0,message:o("users.formValidateMsg.username")}],nickname:[{required:!0,message:o("users.formValidateMsg.nickname")}],password:[{required:!0,message:o("users.formValidateMsg.password")}],disabled:[{required:!0,message:o("users.formValidateMsg.disabled")}],maxWorldsPerCluster:[{required:!0,message:o("users.formValidateMsg.maxWorldsPerCluster")}]},x=V(!1),C=V(!1),k=V(!1),A=()=>{w.value&&w.value.clearValidate(),k.value=!0,x.value=!0},G=()=>{w.value.validate(i=>{if(i){C.value=!0;const r={username:t.value.username,nickname:t.value.nickname,password:B(t.value.password),disabled:t.value.disabled,role:t.value.role,clusterPermission:t.value.clusterPermission,clusterCreationProhibited:t.value.clusterCreationProhibited,maxWorldsPerCluster:t.value.maxWorldsPerCluster};z.user.post(r).then(v=>{x.value=!1,N(v.message),P()}).finally(()=>{C.value=!1})}})},H=i=>{t.value=i,k.value=!1,x.value=!0},J=()=>{w.value.validate(i=>{if(i){C.value=!0;const r={username:t.value.username,nickname:t.value.nickname,password:B("nicai"),disabled:t.value.disabled,role:t.value.role,clusterPermission:t.value.clusterPermission,clusterCreationProhibited:t.value.clusterCreationProhibited,maxWorldsPerCluster:t.value.maxWorldsPerCluster};z.user.put(r).then(v=>{x.value=!1,w.value&&w.value.resetFields(),N(v.message),P()}).finally(()=>{C.value=!1})}})},K=i=>{ge.confirm(d.value==="zh"?"将执行 删除 操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(r,v,f)=>{if(r==="confirm"){v.confirmButtonLoading=!0;const b={username:i.username,nickname:i.nickname,password:B("nicai"),disabled:i.disabled};z.user.delete(b).then(W=>{N(W.message),P(),f()}).finally(()=>{v.confirmButtonLoading=!1})}else f()}}).then(()=>{}).catch(()=>{he(o("home.canceled"))})},X=()=>{t.value={username:"",nickname:"",password:"",disabled:!1,role:"Non-admin",clusterPermission:null,clusterCreationProhibited:!1}};return(i,r)=>{const v=n("el-button"),f=n("el-table-column"),b=n("el-tag"),W=n("QuestionFilled"),q=n("el-icon"),Z=n("el-tooltip"),ee=n("arrow-down"),L=n("el-dropdown-item"),le=n("el-dropdown-menu"),ae=n("el-dropdown"),te=n("el-table"),se=n("el-card"),U=n("el-col"),T=n("el-row"),F=n("el-input"),h=n("el-form-item"),oe=n("el-option"),re=n("el-select"),ne=n("el-slider"),E=n("el-switch"),ue=n("el-form"),ie=n("el-dialog");return m(),j("div",xe,[l(T,{gutter:10},{default:e(()=>[l(U,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:e(()=>[l(se,{shadow:"never",style:{"min-height":"70vh"}},{header:e(()=>[c("div",Ce,[c("span",null,u(a(o)("users.accountTitle")),1),l(v,{disabled:a(S).role!=="admin",type:"success",onClick:A},{default:e(()=>[p(u(a(o)("users.actions.create")),1)]),_:1},8,["disabled"])])]),default:e(()=>[a(y)?g("",!0):(m(),_(ye,{key:0,title:d.value==="zh"?"注意事项":"Tips","dark-mode":Q.value},{default:e(()=>[c("div",ke,[c("div",null,u(a(o)("users.tip_1")),1),c("div",Ve,u(a(o)("users.tip_2")),1),c("div",Pe,u(a(o)("users.tip_3")),1)]),c("div",Ue,[c("div",null,u(a(o)("users.tip_4")),1)]),c("div",ze,u(a(o)("users.tip_5")),1),c("div",De,u(a(o)("users.tip_6")),1)]),_:1},8,["title","dark-mode"])),l(te,{data:M.value,border:"",style:{"margin-top":"10px"}},{default:e(()=>[l(f,{label:a(o)("users.username"),prop:"username"},null,8,["label"]),l(f,{label:a(o)("users.nickname"),prop:"nickname"},null,8,["label"]),l(f,{label:a(o)("users.role"),prop:"role"},{default:e(s=>[l(b,{type:s.row.role==="admin"?"primary":"info"},{default:e(()=>[p(u(s.row.role),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(f,{label:a(o)("users.disabled")},{default:e(s=>[s.row.disabled?g("",!0):(m(),_(b,{key:0,type:"success"},{default:e(()=>[p(u(d.value==="zh"?"启用":"Enabled"),1)]),_:1})),s.row.disabled?(m(),_(b,{key:1,type:"danger"},{default:e(()=>[p(u(d.value==="zh"?"禁用":"Disabled"),1)]),_:1})):g("",!0)]),_:1},8,["label"]),l(f,{label:a(o)("users.clusterCreationProhibited")},{default:e(s=>[s.row.clusterCreationProhibited?g("",!0):(m(),_(b,{key:0,type:"success"},{default:e(()=>[p(u(d.value==="zh"?"可创建":"Y"),1)]),_:1})),s.row.clusterCreationProhibited?(m(),_(b,{key:1,type:"danger"},{default:e(()=>[p(u(d.value==="zh"?"不可创建":"N"),1)]),_:1})):g("",!0)]),_:1},8,["label"]),l(f,null,{header:e(()=>[c("div",Se,[c("span",null,u(a(o)("users.maxWorldsPerCluster")),1),l(Z,{content:a(o)("users.maxWorldsPerClusterTip"),effect:"light",placement:"top"},{default:e(()=>[l(q,{size:"14",style:{"margin-left":"2px"}},{default:e(()=>[l(W)]),_:1})]),_:1},8,["content"])])]),default:e(s=>[s.row.role==="admin"?(m(),_(b,{key:0,type:"primary"},{default:e(()=>[p(u(d.value==="zh"?"不限制":"No Limits"),1)]),_:1})):(m(),_(b,{key:1,type:"primary"},{default:e(()=>[p(u(s.row.maxWorldsPerCluster),1)]),_:2},1024))]),_:1}),l(f,{label:a(o)("setting.button.actions"),prop:"actions"},{default:e(s=>[l(ae,{disabled:a(S).role!=="admin",trigger:"hover",onCommand:Y},{dropdown:e(()=>[l(le,null,{default:e(()=>[l(L,{command:{type:"update",data:s.row}},{default:e(()=>[p(u(a(o)("users.actions.update")),1)]),_:2},1032,["command"]),l(L,{command:{type:"delete",data:s.row},disabled:s.row.role==="admin"},{default:e(()=>[p(u(a(o)("users.actions.delete")),1)]),_:2},1032,["command","disabled"])]),_:2},1024)]),default:e(()=>[l(v,{disabled:a(S).role!=="admin",link:"",type:"primary"},{default:e(()=>[p(u(a(o)("setting.button.actions"))+" ",1),l(q,{class:"el-icon--right"},{default:e(()=>[l(ee)]),_:1})]),_:1},8,["disabled"])]),_:2},1032,["disabled"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),l(ie,{modelValue:x.value,"onUpdate:modelValue":r[9]||(r[9]=s=>x.value=s),width:"60%",onClosed:X},{default:e(()=>[l(ue,{ref_key:"userDialogFormRef",ref:w,model:t.value,rules:$,"validate-on-rule-change":!1,"label-width":"150","label-position":a(y)?"top":"left",style:{margin:"20px 50px 0 0"}},{default:e(()=>[k.value?(m(),_(h,{key:0,label:a(o)("users.username"),prop:"username"},{default:e(()=>[l(F,{modelValue:t.value.username,"onUpdate:modelValue":r[0]||(r[0]=s=>t.value.username=s)},null,8,["modelValue"])]),_:1},8,["label"])):g("",!0),l(h,{label:a(o)("users.nickname"),prop:"nickname"},{default:e(()=>[l(F,{modelValue:t.value.nickname,"onUpdate:modelValue":r[1]||(r[1]=s=>t.value.nickname=s)},null,8,["modelValue"])]),_:1},8,["label"]),k.value?(m(),_(h,{key:1,label:a(o)("users.password"),prop:"password"},{default:e(()=>[l(F,{modelValue:t.value.password,"onUpdate:modelValue":r[2]||(r[2]=s=>t.value.password=s),autocomplete:"new-password","show-password":""},null,8,["modelValue"]),l(we,{modelValue:t.value.password,"onUpdate:modelValue":r[3]||(r[3]=s=>t.value.password=s)},null,8,["modelValue"]),c("div",We,u(a(o)("users.suggestedPassword")),1)]),_:1},8,["label"])):g("",!0),l(h,{label:a(o)("users.clusterPermission"),prop:"clusterPermission"},{default:e(()=>[l(re,{modelValue:t.value.clusterPermission,"onUpdate:modelValue":r[4]||(r[4]=s=>t.value.clusterPermission=s),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:t.value.role==="admin"},{default:e(()=>[(m(!0),j(ve,null,fe(a(D).dstClusters,s=>(m(),_(oe,{label:s.clusterDisplayName,value:s.clusterName},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),l(h,{label:a(o)("users.maxWorldsPerCluster"),prop:"maxWorldsPerCluster"},{default:e(()=>[l(ne,{modelValue:t.value.maxWorldsPerCluster,"onUpdate:modelValue":r[5]||(r[5]=s=>t.value.maxWorldsPerCluster=s),max:64,min:0,"show-input":!a(y),size:"small"},null,8,["modelValue","show-input"])]),_:1},8,["label"]),l(T,null,{default:e(()=>[l(U,{span:a(y)?24:8},{default:e(()=>[l(h,{label:a(o)("users.disabled"),prop:"disabled"},{default:e(()=>[l(E,{modelValue:t.value.disabled,"onUpdate:modelValue":r[6]||(r[6]=s=>t.value.disabled=s),"active-text":d.value==="zh"?"启用":"Enable","active-value":!1,"inactive-text":d.value==="zh"?"禁用":"Disable","inactive-value":!0,"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])]),_:1},8,["span"]),l(U,{span:a(y)?24:8},{default:e(()=>[l(h,{label:a(o)("users.admin"),prop:"role"},{default:e(()=>[l(E,{modelValue:t.value.role,"onUpdate:modelValue":r[7]||(r[7]=s=>t.value.role=s),"active-text":d.value==="zh"?"是":"Enable","inactive-text":d.value==="zh"?"否":"Disable","active-value":"admin","inactive-value":"Non-admin","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])]),_:1},8,["span"]),l(U,{span:a(y)?24:8},{default:e(()=>[l(h,{label:a(o)("users.clusterCreationProhibited"),prop:"role"},{default:e(()=>[l(E,{modelValue:t.value.clusterCreationProhibited,"onUpdate:modelValue":r[8]||(r[8]=s=>t.value.clusterCreationProhibited=s),"active-text":d.value==="zh"?"可创建":"Y","active-value":!1,"inactive-text":d.value==="zh"?"不可创建":"Y","inactive-value":!0,"inline-prompt":"",disabled:t.value.role==="admin",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text","disabled"])]),_:1},8,["label"])]),_:1},8,["span"])]),_:1}),c("div",Fe,[k.value?(m(),_(v,{key:0,loading:C.value,type:"primary",onClick:G},{default:e(()=>[p(u(a(o)("users.submit")),1)]),_:1},8,["loading"])):g("",!0),k.value?g("",!0):(m(),_(v,{key:1,loading:C.value,type:"primary",onClick:J},{default:e(()=>[p(u(a(o)("users.submit")),1)]),_:1},8,["loading"]))])]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])])}}});export{Te as default};
