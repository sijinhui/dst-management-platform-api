import{o as L,u as H,g as K,c as M,a as Q,r as m,e as W,J as r,f as u,i as z,l as t,m as e,z as V,j as a,n as p,t as s,p as i,q as f,v as B,$ as X,B as Y}from"./index-CnGsCQVR.js";import{t as k}from"./index-BNnN41-c.js";import{e as Z}from"./tools-CmP39zM0.js";import{e as ee}from"./index-D7VhyqD7.js";const te={class:"page-div"},le={class:"card-header"},se={class:"card-header"},ae={style:{"margin-top":"5px"}},oe={class:"card-header"},ne={style:{"margin-top":"10px"}},ie={key:0},re={key:1},ce=X({name:"toolsInstall"}),fe=Object.assign(ce,{setup(ue){L(()=>{q(),O(),j()});const{t:o}=H(),N=K(),x=M(()=>N.language),{isMobile:w}=Q(),T=M(()=>N.isDark),d=m(!1),_=m(0),g=m({zh:"",en:""}),n=m({}),q=()=>{k.osInfo.get().then(l=>{n.value=l.data,n.value.Uptime=Z(l.data.Uptime,x.value)})},P=()=>{k.install.post().then(l=>{Y(l.message),d.value=!0,U()})},A=()=>{k.installStatus.get().then(l=>{const y=l.data;_.value=y.process,g.value.zh=y.zh,g.value.en=y.en,(_.value==="100"||_.value===0)&&h()})},C=m({server:-1,local:-1}),O=()=>{ee.dstVersion.get().then(l=>{l.data&&(C.value=l.data)})},j=()=>{k.isInstalling.get().then(l=>{l.data&&(d.value=!0,U())})};let v=null;const U=()=>{v=setInterval(()=>{A()},1e3)},h=()=>{d.value=!1,v&&(clearInterval(v),v=null)};return W(()=>{h(),window.removeEventListener("beforeunload",h)}),(l,y)=>{const c=r("el-descriptions-item"),E=r("el-descriptions"),I=r("el-card"),b=r("el-col"),S=r("el-button"),D=r("el-result"),G=r("el-text"),$=r("el-row"),R=r("el-alert"),F=r("el-tag"),J=r("el-progress");return u(),z("div",te,[t($,{gutter:20},{default:e(()=>[t(b,{lg:12,md:12,sm:24,span:12,xs:24},{default:e(()=>[t(I,{style:V(a(w)?"min-height: 300px":"min-height: 500px"),shadow:"never"},{header:e(()=>[p("span",le,s(a(o)("tools.install.systemInfo")),1)]),default:e(()=>[t(E,{column:1,border:""},{default:e(()=>[t(c,{label:l.$t("tools.install.architecture")},{default:e(()=>[i(s(n.value.Architecture),1)]),_:1},8,["label"]),t(c,{label:l.$t("tools.install.osType")},{default:e(()=>[i(s(n.value.OS),1)]),_:1},8,["label"]),t(c,{label:l.$t("tools.install.osName")},{default:e(()=>[i(s(n.value.Platform),1)]),_:1},8,["label"]),t(c,{label:l.$t("tools.install.osVersion")},{default:e(()=>[i(s(n.value.PlatformVersion),1)]),_:1},8,["label"]),t(c,{label:"CPU"},{default:e(()=>[i(s(n.value.CPUModel),1)]),_:1}),t(c,{label:a(o)("tools.install.cpuCore")},{default:e(()=>[i(s(n.value.CPUCores),1)]),_:1},8,["label"]),t(c,{label:l.$t("tools.install.memory")},{default:e(()=>[i(s((n.value.MemorySize/1024**3).toFixed(2))+" GB ",1)]),_:1},8,["label"]),t(c,{label:l.$t("tools.install.uptime")},{default:e(()=>[i(s(n.value.Uptime),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["style"])]),_:1}),t(b,{lg:12,md:12,sm:24,span:12,style:V(a(w)?"margin-top: 20px":"margin-top: 0px"),xs:24},{default:e(()=>[t(I,{style:V(a(w)?"min-height: 300px":"min-height: 500px"),shadow:"never"},{header:e(()=>[p("span",se,s(l.$t("tools.install.installCheck")),1)]),default:e(()=>[n.value.Platform==="ubuntu"||n.value.Platform==="centos"||n.value.Platform==="rocky"?(u(),f(D,{key:0,"sub-title":C.value.local>-1?a(o)("tools.install.checkPassDesc1"):a(o)("tools.install.checkPassDesc"),title:a(o)("tools.install.checkPass"),icon:"success"},{extra:e(()=>[C.value.local>-1?(u(),f(S,{key:0,loading:d.value,type:"warning",onClick:P},{default:e(()=>[i(s(a(o)("tools.install.reinstall")),1)]),_:1},8,["loading"])):(u(),f(S,{key:1,loading:d.value,type:"primary",onClick:P},{default:e(()=>[i(s(a(o)("tools.install.install")),1)]),_:1},8,["loading"]))]),_:1},8,["sub-title","title"])):(u(),f(D,{key:1,"sub-title":a(o)("tools.install.checkNotPassDesc"),title:a(o)("tools.install.checkNotPass"),icon:"warning"},{extra:e(()=>[p("div",null,[t(S,{disabled:n.value.Platform==="darwin",loading:d.value,type:"warning",onClick:P},{default:e(()=>[i(s(a(o)("tools.install.install")),1)]),_:1},8,["disabled","loading"])]),p("div",ae,[t(G,{type:"info"},{default:e(()=>[i(s(a(o)("tools.install.macosTip")),1)]),_:1})])]),_:1},8,["sub-title","title"]))]),_:1},8,["style"])]),_:1},8,["style"])]),_:1}),t($,{gutter:20},{default:e(()=>[t(b,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"20px"}},{default:e(()=>[t(R,{closable:!1,effect:T.value?"light":"dark",type:"success"},{default:e(()=>[i(s(a(o)("tools.install.installTip")),1)]),_:1},8,["effect"])]),_:1})]),_:1}),d.value?(u(),f($,{key:0,gutter:20},{default:e(()=>[t(b,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"20px"}},{default:e(()=>[t(I,{shadow:"never",style:{"min-height":"250px"}},{header:e(()=>[p("div",oe,[p("span",null,s(a(o)("tools.install.installProgress")),1),t(F,{style:{"font-weight":"lighter"},type:"warning"},{default:e(()=>[i(s(a(o)("tools.install.noClose")),1)]),_:1})])]),default:e(()=>[t(J,{percentage:_.value,status:_.value===100?"success":"","stroke-width":15,striped:"","striped-flow":""},null,8,["percentage","status"]),p("div",ne,[x.value==="zh"?(u(),z("span",ie,s(g.value.zh),1)):B("",!0),x.value==="en"?(u(),z("span",re,s(g.value.en),1)):B("",!0)])]),_:1})]),_:1})]),_:1})):B("",!0)])}}});export{fe as default};
