import{o as ge,u as be,g as we,D as he,G as ye,d as Ne,H as Ce,c as U,r as _,a0 as w,w as De,I as Y,J as i,K as ke,f as v,i as T,l as t,m as e,j as n,n as N,t as u,s as Z,q as C,p as m,v as ee,F as te,x as xe,$ as ze,A as Be,B as V,E as q,C as F}from"./index-CnGsCQVR.js";const Te={class:"page-div"},Ve={class:"tip_warning"},Pe={class:"tip_success",style:{"margin-top":"20px"}},Ae={class:"fcc",style:{"font-size":"20px"}},Le={key:0},Ee={class:"tip"},Ie={style:{margin:"20px"}},Se={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Ue=ze({name:"Clusters"}),Ke=Object.assign(Ue,{setup(qe){ge(()=>{k(),x()});const{t:l}=be(),f=we(),D=he();ye();const K=Ne(),M=Ce("refresh"),ae=U(()=>f.isDark),d=U(()=>f.language),j="info",P=_(!1),A=_(!1),O=U(()=>P.value||A.value),L=_([]),k=()=>{P.value=!0,w.clusters.get().then(o=>{L.value=o.data}).finally(()=>{P.value=!1})},E=_([]),R=_(0),W=_(0),$=_([]),x=()=>{A.value=!0,w.clustersWorldPort.get().then(o=>{E.value=o.data;let s=[];for(let c of E.value)if(c.worldPort!==null)for(let r of c.worldPort)s.push(r);R.value=s.length,W.value=new Set(s).size,$.value=s.filter((c,r)=>s.indexOf(c)!==r)}).finally(()=>{A.value=!1})},I=()=>{w.clusters.get().then(o=>{f.dstClusters=o.data,f.selectedDstCluster===null&&f.dstClusters!==null&&(f.selectedDstCluster=f.dstClusters[0].clusterName)})},z=_(!1),S=_(!1),g=_({clusterName:"",clusterDisplayName:""}),le=o=>{g.value={clusterName:o.clusterName,clusterDisplayName:""},z.value=!0},oe=()=>{if(g.value===""){Be(d.value==="zh"?"请输入集群昵称":"cluster nickname is required");return}S.value=!0,w.cluster.put(g.value).then(o=>{w.clusters.get().then(s=>{L.value=s.data,f.dstClusters=s.data}),V(o.message),z.value=!1}).finally(()=>{S.value=!1})},se=o=>{const s=o.clusterName;q.confirm(d.value==="zh"?"将执行 删除集群 操作，是否继续？":"The cluster DELETE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(c,r,p)=>{if(c==="confirm"){r.confirmButtonLoading=!0;const h={clusterName:s};w.cluster.delete(h).then(async b=>{V(b.message),await k(),await x(),await I(),f.selectedDstCluster===s&&f.dstClusters!==null&&(f.selectedDstCluster=f.dstClusters[0].clusterName),p()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1})}else p()}}).then(()=>{}).catch(()=>{F(l("home.canceled"))})},ne=o=>{const s=o.clusterName;q.confirm(d.value==="zh"?"将执行 激活集群 操作，是否继续？":"The cluster ACTIVATE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(c,r,p)=>{if(c==="confirm"){r.confirmButtonLoading=!0;const h={clusterName:s,status:!0};w.cluster.status.put(h).then(async b=>{V(b.message),await k(),await x(),await I(),p()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1})}else p()}}).then(()=>{}).catch(()=>{F(l("home.canceled"))})},re=o=>{const s=o.clusterName;q.confirm(d.value==="zh"?"将执行 关闭集群 操作，是否继续？":"The cluster DEACTIVATE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(c,r,p)=>{if(c==="confirm"){r.confirmButtonLoading=!0;const h={clusterName:s,status:!1};w.cluster.status.put(h).then(async b=>{V(b.message),await k(),await x(),await I(),p()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1})}else p()}}).then(()=>{}).catch(()=>{F(l("home.canceled"))})},ue=o=>{switch(o.type){case"activate":ne(o.row);break;case"deactivate":re(o.row);break;case"update":le(o.row);break;case"delete":se(o.row);break}},ce=()=>{setTimeout(()=>{D.meta.isKeepAlive&&K.removeKeepAliveName(D.name),M(!1),Y(()=>{D.meta.isKeepAlive&&K.addKeepAliveName(D.name),M(!0)})},0)};return De(()=>f.selectedDstCluster,o=>{o&&Y(()=>{ce()})},{immediate:!1}),(o,s)=>{const c=i("el-tag"),r=i("el-table-column"),p=i("arrow-down"),h=i("el-icon"),b=i("el-button"),B=i("el-dropdown-item"),ie=i("el-dropdown-menu"),de=i("el-dropdown"),G=i("el-table"),H=i("el-tab-pane"),me=i("el-alert"),fe=i("el-text"),pe=i("el-tabs"),J=i("el-input"),Q=i("el-form-item"),_e=i("el-form"),ve=i("el-dialog"),X=ke("loading");return v(),T("div",Te,[t(pe,{modelValue:j,"onUpdate:modelValue":s[0]||(s[0]=a=>j=a)},{default:e(()=>[t(H,{label:n(l)("clusters.tab.pane1"),name:"info"},{default:e(()=>[N("div",Ve,u(n(l)("clusters.tip1")),1),Z((v(),C(G,{data:L.value,border:""},{default:e(()=>[t(r,{label:n(l)("clusters.table.name")},{default:e(a=>[t(c,{type:"primary"},{default:e(()=>[m(u(a.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),t(r,{label:n(l)("clusters.table.displayName")},{default:e(a=>[t(c,{type:"success"},{default:e(()=>[m(u(a.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),t(r,{label:n(l)("clusters.table.status")},{default:e(a=>[a.row.status?(v(),C(c,{key:0,type:"success"},{default:e(()=>[m(u(d.value==="zh"?"激活":"Activated"),1)]),_:1})):(v(),C(c,{key:1,type:"info"},{default:e(()=>[m(u(d.value==="zh"?"关闭":"Deactivated"),1)]),_:1}))]),_:1},8,["label"]),t(r,{label:n(l)("clusters.table.world")},{default:e(a=>[t(c,{type:"info"},{default:e(()=>{var y;return[m(u(((y=a.row.worlds)==null?void 0:y.length)||0),1)]}),_:2},1024)]),_:1},8,["label"]),t(r,{label:n(l)("clusters.table.actions")},{default:e(a=>[t(de,{trigger:"hover",onCommand:ue},{dropdown:e(()=>[t(ie,null,{default:e(()=>[t(B,{command:{type:"activate",row:a.row}},{default:e(()=>[m(u(n(l)("clusters.table.action.activate")),1)]),_:2},1032,["command"]),t(B,{command:{type:"deactivate",row:a.row}},{default:e(()=>[m(u(n(l)("clusters.table.action.deactivate")),1)]),_:2},1032,["command"]),t(B,{command:{type:"update",row:a.row},divided:""},{default:e(()=>[m(u(n(l)("clusters.table.action.update")),1)]),_:2},1032,["command"]),t(B,{command:{type:"delete",row:a.row}},{default:e(()=>[m(u(n(l)("clusters.table.action.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:e(()=>[t(b,{link:"",type:"primary"},{default:e(()=>[m(u(n(l)("clusters.table.actions"))+" ",1),t(h,{class:"el-icon--right"},{default:e(()=>[t(p)]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[X,O.value]])]),_:1},8,["label"]),t(H,{label:n(l)("clusters.tab.pane2"),name:"port"},{default:e(()=>[N("div",Pe,u(n(l)("clusters.tip2")),1),W.value!==R.value?(v(),C(me,{key:0,effect:ae.value?"light":"dark",type:"error",closable:!1,style:{"margin-bottom":"10px"}},{title:e(()=>[N("div",Ae,u(n(l)("clusters.tip3")),1)]),_:1},8,["effect"])):ee("",!0),Z((v(),C(G,{data:E.value,border:""},{default:e(()=>[t(r,{label:n(l)("clusters.table.name")},{default:e(a=>[t(c,{type:"primary"},{default:e(()=>[m(u(a.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),t(r,{label:n(l)("clusters.table.displayName")},{default:e(a=>[t(c,{type:"success"},{default:e(()=>[m(u(a.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),t(r,{label:n(l)("clusters.table.port")},{default:e(a=>[a.row.worldPort?(v(!0),T(te,{key:0},xe(a.row.worldPort,y=>(v(),T(te,null,[t(fe,{tag:$.value.includes(y)?"mark":"span"},{default:e(()=>[m(u(y),1)]),_:2},1032,["tag"]),a.row.worldPort.indexOf(y)!==a.row.worldPort.length-1?(v(),T("span",Le,",")):ee("",!0)],64))),256)):(v(),C(c,{key:1,type:"info"},{default:e(()=>[m(u(n(l)("clusters.table.none")),1)]),_:1}))]),_:1},8,["label"])]),_:1},8,["data"])),[[X,O.value]])]),_:1},8,["label"])]),_:1}),t(ve,{modelValue:z.value,"onUpdate:modelValue":s[3]||(s[3]=a=>z.value=a),width:"65%"},{header:e(()=>[m(u(n(l)("clusters.updateDialog.title")),1)]),default:e(()=>[N("div",Ee,u(n(l)("clusters.updateDialog.tip1")),1),N("div",Ie,[t(_e,{model:g.value},{default:e(()=>[t(Q,{label:n(l)("clusters.updateDialog.clusterName")},{default:e(()=>[t(J,{disabled:"",modelValue:g.value.clusterName,"onUpdate:modelValue":s[1]||(s[1]=a=>g.value.clusterName=a)},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:n(l)("clusters.updateDialog.newDisplayName")},{default:e(()=>[t(J,{modelValue:g.value.clusterDisplayName,"onUpdate:modelValue":s[2]||(s[2]=a=>g.value.clusterDisplayName=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),N("div",Se,[t(b,{type:"primary",onClick:oe,loading:S.value},{default:e(()=>[m(u(d.value==="zh"?"更新":"Update"),1)]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])])}}});export{Ke as default};
