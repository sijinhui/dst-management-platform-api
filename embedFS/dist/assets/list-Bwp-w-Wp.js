import{g as M,e as O,b as H,f as n,j as J,r as Q,A as _,o as f,w as l,a,ab as R,k as C,t as u,l as o,s as w,v as y,x as S,V as A,p as N,c as U,F as W,y as X,D as Y,ah as Z,G as g,aC as ee}from"./index-D0_VvR3J.js";import{p as x}from"./player-CxwIdG77.js";import{V as te}from"./VDialog-laDXRq-G.js";import{V as $}from"./VAlert-Cnu_GEOX.js";import{V as le}from"./VContainer-BdgJJao2.js";import{V as ae}from"./VRow-T4pZZsdz.js";import{V as oe}from"./VCol-B5VJ-k2B.js";import{V as se}from"./VChip-Bl_XNOgC.js";import{V as re}from"./VTextField-BDhl3HoB.js";import"./axios-B3QxYxjQ.js";import"./dialog-transition-Bnn_UDo8.js";/* empty css              */import"./index-BYTG7FXw.js";import"./VInput-CQ0d1937.js";const ie={class:"card-header my-2"},ne={key:0},ue={class:"d-flex align-center",style:{width:"160px"}},we={__name:"list",props:{listType:{type:String,default:""},height:{type:Number,default:0},uidmap:{type:Array,default:()=>[]}},setup(q){const i=q,k=M(),{mobile:z}=O(),{t:s}=H(),D=n([]),b=n(!1),h=(r=!1)=>{b.value=!0;const e={roomID:k.room.id,listType:i.listType};x.list.get(e).then(c=>{D.value=c.data||[],r&&g(s("game.player.list.refreshSuccess"))}).finally(()=>{b.value=!1})},F=n(!1),I=(r,e)=>{F.value=!0;const c={roomID:k.room.id,listType:i.listType,uids:[r],actionType:e};x.list.post(c).then(t=>{g(t.message),h()}).finally(()=>{F.value=!1})},T=n(!1),L=n(),d=n(""),E=()=>{T.value=!0,ee(()=>{L.value.focus()})},B=()=>{if(d.value){if(!/^KU_/.test(d.value)){g(s("game.player.list.uidValid"),"error");return}I(d.value,"add")}T.value=!1,d.value=""},p=n(!1),K=()=>{p.value=!0},P=r=>/\.txt$/i.test(r.name),v=n(!1),j=r=>{if(v.value=!0,!P(r)){g(s("game.player.list.import.fileTypeError"),"error"),p.value=!1,v.value=!1;return}const e=new FileReader;e.readAsText(r),e.onload=()=>{const t=e.result.split(`
`),m=[];for(let V of t)V!==""&&m.push(V);const G={roomID:k.room.id,listType:i.listType,uids:m,actionType:"add"};x.list.post(G).then(V=>{g(V.message),h()}).finally(()=>{v.value=!1,p.value=!1})},e.onerror=()=>{g(s("game.player.list.import.fileReadError"),"error"),v.value=!1,p.value=!1}};return J(()=>{h()}),(r,e)=>{const c=Q("v-file-upload");return f(),_(A,{class:"mt-4",height:i.height-70},{default:l(()=>[a(R,null,{default:l(()=>[C("div",ie,[C("span",null,u(o(s)(`game.player.list.${i.listType}`)),1),C("div",null,[a(w,{class:"mr-2",onClick:K},{default:l(()=>[y(u(o(s)("game.player.list.import.title")),1)]),_:1}),a(te,{modelValue:o(p),"onUpdate:modelValue":e[0]||(e[0]=t=>S(p)?p.value=t:null),width:o(z)?"90%":"45%"},{default:l(()=>[a(A,null,{default:l(()=>[a(R),a(N,null,{default:l(()=>[a($,{color:"warning",density:"compact",class:"mt-2 mb-2"},{default:l(()=>[y(u(o(s)("game.player.list.import.tip")),1)]),_:1}),a(c,{density:"default",icon:"ri-upload-cloud-2-line","onUpdate:modelValue":j})]),_:1})]),_:1})]),_:1},8,["modelValue","width"]),a(w,{color:"default",onClick:e[1]||(e[1]=t=>h(!0))},{default:l(()=>[y(u(o(s)("game.player.list.refresh")),1)]),_:1})])])]),_:1}),a(N,null,{default:l(()=>[a(le,{fluid:"",height:i.height-152,style:{"overflow-y":"auto"}},{default:l(()=>[a(ae,null,{default:l(()=>[a($,{color:"success",density:"compact"},{default:l(()=>[y(u(o(s)("game.player.list.tip")),1)]),_:1}),a(oe,{class:"mt-4",cols:"12"}),(f(!0),U(W,null,X(o(D),t=>(f(),_(se,{key:t,closable:"",color:"info",class:"mt-2 mr-2",label:"",size:"large","onClick:close":m=>I(t,"delete")},{default:l(()=>[y(u(t)+" ",1),(i.uidmap.find(m=>m.uid===t)?.nickname||"")!==""?(f(),U("span",ne," ("+u(i.uidmap.find(m=>m.uid===t)?.nickname||"")+") ",1)):Y("",!0)]),_:2},1032,["onClick:close"]))),128)),C("div",ue,[o(T)?(f(),_(re,{key:0,ref_key:"inputRef",ref:L,modelValue:o(d),"onUpdate:modelValue":e[2]||(e[2]=t=>S(d)?d.value=t:null),density:"compact",placeholder:o(s)("game.player.list.placeholder"),class:"mt-2",onKeyup:Z(B,["enter"]),onBlur:B},null,8,["modelValue","placeholder"])):(f(),_(w,{key:1,variant:"tonal","append-icon":"ri-add-line",color:"default",class:"mt-2 mr-2",onClick:E},{default:l(()=>[y(u(o(s)("game.player.list.add")),1)]),_:1}))])]),_:1})]),_:1},8,["height"])]),_:1})]),_:1},8,["height"])}}};export{we as default};
