import{_ as S}from"./index-BpYFbpuy.js";import{g as T,e as A,b as F,f as s,j as R,c as B,o as D,a as e,w as a,ab as v,k as c,t as p,l,s as b,v as x,p as C,V as w,F as I,aK as L}from"./index-D0_VvR3J.js";import{p as V}from"./player-CxwIdG77.js";import"./axios-B3QxYxjQ.js";const O={class:"card-header"},N={class:"card-header"},E={__name:"statistics",setup(P){const g=T();A();const{t:i}=F(),k=s(),r=s({tooltip:{trigger:"axis"},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{data:[],type:"line",smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(1, 255, 255, 0.8)"},{offset:1,color:"rgba(1, 255, 255,0)"}],global:!1}}}]}),h=s(),u=s({tooltip:{trigger:"item",formatter:`{b}: {c}${i("game.player.statistics.pieChart.unit")}`},legend:{top:"5%",left:"center"},series:[{name:"Top-10",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,padAngle:5,itemStyle:{borderRadius:10},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),d=s(!1),_=()=>{d.value=!0;const n={roomID:g.room.id};V.statistics.playerCount.get(n).then(o=>{if(o.data!=null){r.value.xAxis.data=[],r.value.series[0].data=[];for(let t of o.data)r.value.xAxis.data.push(L(t.timestamp)),r.value.series[0].data.push(t?.playerInfo?.length||0)}}).finally(()=>{d.value=!1})},f=s(!1),y=()=>{f.value=!0;const n={roomID:g.room.id};V.statistics.onlineTime.get(n).then(o=>{o.data!=null&&(u.value.series[0].data=Object.entries(o.data).sort((t,m)=>m[1]-t[1]).slice(0,10).map(([t,m])=>({value:(m/480).toFixed(0),name:t})),h.value.redraw(u.value))}).finally(()=>{f.value=!1})};return R(()=>{_(),y()}),(n,o)=>{const t=S;return D(),B(I,null,[e(w,{class:"mb-8"},{default:a(()=>[e(v,null,{default:a(()=>[c("div",O,[c("span",null,p(l(i)("game.player.statistics.lineChart.title")),1),e(b,{loading:l(d),color:"default",onClick:_},{default:a(()=>[x(p(l(i)("platform.metrics.refresh")),1)]),_:1},8,["loading"])])]),_:1}),e(C,null,{default:a(()=>[e(t,{ref_key:"playerChartRef",ref:k,option:l(r),height:"50vh"},null,8,["option"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(v,null,{default:a(()=>[c("div",N,[c("span",null,p(l(i)("game.player.statistics.pieChart.title")),1),e(b,{loading:l(f),color:"default",onClick:y},{default:a(()=>[x(p(l(i)("platform.metrics.refresh")),1)]),_:1},8,["loading"])])]),_:1}),e(C,null,{default:a(()=>[e(t,{ref_key:"pieChartRef",ref:h,option:l(u),height:"75vh",width:"75vw"},null,8,["option"])]),_:1})]),_:1})],64)}}};export{E as default};
