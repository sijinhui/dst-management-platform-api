import{_ as re}from"./ConfirmBox-qQUgNQN6.js";import{_ as ce}from"./Result-gWT-ossO.js";import{e as de,b as ue,u as me,d as fe,g as ge,f as u,O as pe,j as he,a8 as ve,a9 as _e,c as k,o as r,a,l as e,F as $,k as v,A as m,D as _,ah as be,w as t,v as c,t as i,s as C,y as ye,V as X,z as ke,ab as Ve,Z as we,J as N,U as D,W as B,E as xe,p as Ce,ac as Y,ad as Ne,R as Ie,x as ze,G as E}from"./index-D0_VvR3J.js";import{r as F}from"./room-L8Fn_wZk.js";import{C as Re}from"./vue3-count-to.esm-pWERqc62.js";import{e as Se}from"./eventBus-B8tShFcG.js";import{V as Me}from"./VTextField-BDhl3HoB.js";import{V}from"./VRow-T4pZZsdz.js";import{V as p}from"./VCol-B5VJ-k2B.js";import{V as I}from"./VChip-Bl_XNOgC.js";import{V as Te}from"./VMenu-gAht7neB.js";import{V as Le}from"./VList-B7_QlUC1.js";import{V as $e}from"./VTooltip-DeNPgE8E.js";import{V as De}from"./VSparkline-kkycS52a.js";import{V as Be}from"./VPagination-_V6tKqvs.js";import"./VAlert-Cnu_GEOX.js";import"./VSpacer-BWidqFwK.js";/* empty css              */import"./VDialog-laDXRq-G.js";import"./dialog-transition-Bnn_UDo8.js";import"./VContainer-BdgJJao2.js";import"./axios-B3QxYxjQ.js";import"./index-BYTG7FXw.js";import"./VInput-CQ0d1937.js";import"./ssrBoot-CVvmSRtT.js";const Fe={class:"fcc"},Ge={class:"fcb"},He={class:"fcc"},Pe=["onClick"],Ae={class:"text-caption text-grey"},Ue={class:"text-h3 font-weight-black"},qe={key:1},Ee={key:1},We={key:2},_t={__name:"index",setup(je){const{mobile:f}=de(),{t:l}=ue(),W=me(),w=fe(),b=ge(),R=u(window.innerHeight),j=()=>Math.max(2,Math.floor((R.value-204)/300)*2),g=u({gameName:"",page:1,pageSize:0}),S=u([]),G=u(0),M=u(!1),h=async()=>{M.value=!0;const s=await F.list.get(g.value);S.value=s.data.rows||[],G.value=s.data.total,M.value=!1},K=async()=>{b.room={id:0,gameName:""},ee(),await W.push("/game/base")},ee=()=>{Se.emit("toggleMenu",3)},te=s=>{b.room.id=s.id,b.room.gameName=s.gameName},ae=async s=>{b.room.id=s.id,b.room.gameName=s.gameName,await W.push("/dashboard")},O=s=>{if(s.length===0)return[0,0];const n=[];for(let d of s)n.push(d.playerInfo?.length||0);return n},H=(s,n)=>{switch(s){case"activate":le(n);break;case"deactivate":oe(n);break;case"delete":q.value=n.id,x.value=!0;break}},P=u(!1),le=s=>{P.value=!0;const n={roomID:s.id};F.activate.post(n).then(d=>{E(d.message),h()}).finally(()=>{P.value=!1})},A=u(!1),oe=s=>{A.value=!0;const n={roomID:s.id};F.deactivate.post(n).then(d=>{E(d.message),h()}).finally(()=>{A.value=!1})},U=u(!1),q=u(0),x=u(!1),se=()=>{U.value=!0;const s={roomID:q.value};F.base.delete(s).then(n=>{x.value=!1,E(n.message),h(),b.room.id===q.value&&(b.room.id=0)}).finally(()=>{U.value=!1})},J=s=>s.length===0?0:(s.at(-1)?.playerInfo||[]).length,ne=s=>s.length===0?"":(s.at(-1)?.playerInfo||[]).map(d=>d.nickname).join(", "),z=u(),T=u(0),L=()=>Math.max(2,Math.floor(R.value-120));pe(R,()=>{h()},{immediate:!1});const Z=ve(()=>{R.value=window.innerHeight,g.value.pageSize=j(),z.value&&(T.value=z.value.$el.offsetWidth)},200);return he(async()=>{g.value.pageSize=j(),await h(),z.value&&(T.value=z.value.$el.offsetWidth),window.addEventListener("resize",Z)}),_e(()=>{window.removeEventListener("resize",Z)}),(s,n)=>{const d=ce,ie=re;return r(),k($,null,[e(b).gameVersion.local!==0?(r(),k($,{key:0},[v("div",Fe,[a(Me,{modelValue:e(g).gameName,"onUpdate:modelValue":n[0]||(n[0]=o=>e(g).gameName=o),label:e(l)("rooms.header.input.label"),"append-inner-icon":"ri-search-line",class:"mr-4",loading:e(M),"onClick:appendInner":h,onKeyup:be(h,["enter"])},null,8,["modelValue","label","loading"]),e(f)?_("",!0):(r(),m(C,{key:0,disabled:!e(w).userInfo.roomCreation&&e(w).userInfo.role!=="admin","prepend-icon":"ri-add-line",variant:"elevated",size:"large",class:"mr-4",onClick:K},{default:t(()=>[c(i(e(l)("rooms.header.button.create")),1)]),_:1},8,["disabled"])),e(f)?_("",!0):(r(),m(C,{key:1,"prepend-icon":"ri-refresh-line",color:"default",variant:"elevated",size:"large",onClick:h},{default:t(()=>[c(i(e(l)("rooms.header.button.refresh")),1)]),_:1})),e(f)?(r(),m(C,{key:2,disabled:!e(w).userInfo.roomCreation&&e(w).userInfo.role!=="admin",icon:"ri-add-line",class:"mr-4",onClick:K},null,8,["disabled"])):_("",!0),e(f)?(r(),m(C,{key:3,icon:"ri-refresh-line",color:"default",onClick:h})):_("",!0)]),a(V,{class:"mt-8"},{default:t(()=>[a(V,{class:"mx-1"},{default:t(()=>[(r(!0),k($,null,ye(e(S),(o,Q)=>(r(),m(p,{key:Q,cols:e(f)?12:6},{default:t(()=>[a(X,{ref_for:!0,ref:y=>{Q===0&&(z.value=y)},hover:"",variant:"flat",height:"300px"},{default:t(()=>[a(Ve,null,{default:t(()=>[v("div",Ge,[v("div",He,[a(I,{color:"primary"},{default:t(()=>[c(i(e(we)(o.gameName,e(f)?8:15)),1)]),_:2},1024),a(I,{color:o.status?"success":"warning",class:"ml-4"},{default:t(()=>[c(i(o.status?e(l)("rooms.card.success.header.title.activated"):e(l)("rooms.card.success.header.title.deactivated")),1)]),_:2},1032,["color"]),e(b).room.id===o.id?(r(),m(N,{key:0,icon:"ri-crosshair-2-line",color:"info",class:"ml-4"})):_("",!0)]),a(Te,null,{activator:t(({props:y})=>[a(C,xe({ref_for:!0},y,{disabled:e(M),loading:e(P)||e(A),color:"primary",icon:"ri-more-2-line"}),null,16,["disabled","loading"])]),default:t(()=>[a(Le,null,{default:t(()=>[a(D,{class:"text-success",onClick:y=>ae(o)},{prepend:t(()=>[a(N,{icon:"ri-checkbox-circle-line",size:"22"})]),default:t(()=>[a(B,null,{default:t(()=>[c(i(e(l)("rooms.card.success.header.menu.select")),1)]),_:1})]),_:1},8,["onClick"]),a(D,{class:"text-success",disabled:o.status,onClick:y=>H("activate",o)},{prepend:t(()=>[a(N,{icon:"ri-play-large-line",size:"22"})]),default:t(()=>[a(B,null,{default:t(()=>[c(i(e(l)("rooms.card.success.header.menu.activate")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(D,{class:"text-warning",disabled:!o.status,onClick:y=>H("deactivate",o)},{prepend:t(()=>[a(N,{icon:"ri-stop-large-line",color:"warning",size:"22"})]),default:t(()=>[a(B,null,{default:t(()=>[c(i(e(l)("rooms.card.success.header.menu.deactivate")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(D,{class:"text-error",disabled:e(w).userInfo.role!=="admin",onClick:y=>H("delete",o)},{prepend:t(()=>[a(N,{icon:"ri-delete-bin-line",size:"22"})]),default:t(()=>[a(B,null,{default:t(()=>[c(i(e(l)("platform.rooms.actions.delete")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024),ke((r(),m(Ce,null,{default:t(()=>[o.gameName!==""?(r(),k("div",{key:0,class:"mt-4",onClick:y=>te(o)},[a(V,null,{default:t(()=>[a(p,{cols:e(f)?12:6},{default:t(()=>[a(V,null,{default:t(()=>[a(p,{cols:"6"},{default:t(()=>[v("span",null,i(e(l)("rooms.card.success.text.left.gameMode")),1)]),_:1}),a(p,{cols:"6"},{default:t(()=>[a(I,{color:"info",label:""},{default:t(()=>[c(i(e(l)(`game.base.step1.gameMode.modes.${o.gameMode}`)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(V,null,{default:t(()=>[a(p,{cols:"6"},{default:t(()=>[v("span",null,i(e(l)("rooms.card.success.text.left.worldNum")),1)]),_:1}),a(p,{cols:"6"},{default:t(()=>[a(I,{color:"info",label:""},{default:t(()=>[c(i(o.worlds.length),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(V,null,{default:t(()=>[a(p,{cols:"6"},{default:t(()=>[v("span",null,i(e(l)("rooms.card.success.text.left.modNum")),1)]),_:1}),a(p,{cols:"6"},{default:t(()=>[a(I,{color:"info",label:""},{default:t(()=>[c(i(o.modInOne?e(Y)(o.modData).length:e(Y)(o.worlds[0].modData).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(V,null,{default:t(()=>[a(p,{cols:"6"},{default:t(()=>[v("span",null,i(e(l)("rooms.card.success.text.left.playerNum")),1)]),_:1}),a(p,{cols:"6"},{default:t(()=>[a(I,{color:"info",label:""},{default:t(()=>[J(o.players)!==0?(r(),m($e,{key:0,activator:"parent"},{default:t(()=>[c(i(ne(o.players)),1)]),_:2},1024)):_("",!0),c(" ("+i(J(o.players))+"/"+i(o.maxPlayer)+") ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["cols"]),e(f)?_("",!0):(r(),m(p,{key:0,cols:e(f)?12:6},{default:t(()=>[a(X,{height:240,variant:"flat"},{prepend:t(()=>[a(N,{color:"primary",class:"me-8",icon:"ri-line-chart-line",size:"48"})]),title:t(()=>[v("div",Ae,i(e(l)("rooms.card.success.text.right.chartTitle")),1),v("span",Ue,[a(e(Re),{duration:4e3,"end-val":Math.max(...O(o.players)),"start-val":0},null,8,["end-val"])]),v("strong",null,i(e(l)("rooms.card.success.text.right.unit")),1)]),default:t(()=>[a(Ne,{color:"transparent"},{default:t(()=>[a(De,{width:e(f)?e(T):e(T)/2,gradient:["#1feaea"],"line-width":3,"model-value":O(o.players),smooth:"",padding:"8","stroke-linecap":"round","auto-draw":""},null,8,["width","model-value"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["cols"]))]),_:2},1024)],8,Pe)):(r(),k("div",qe,[a(d,{type:"warning",height:e(f)?600:300,title:e(l)("rooms.card.warning.title"),"sub-title":e(l)("rooms.card.warning.subTitle")},null,8,["height","title","sub-title"])]))]),_:2},1024)),[[Ie]])]),_:2},1536)]),_:2},1032,["cols"]))),128))]),_:1})]),_:1}),e(G)>e(g).pageSize?(r(),m(Be,{key:0,modelValue:e(g).page,"onUpdate:modelValue":[n[1]||(n[1]=o=>e(g).page=o),h],length:Math.max(1,Math.ceil(e(G)/e(g).pageSize)),class:"mt-8"},null,8,["modelValue","length"])):_("",!0),e(S).length===0&&e(g).gameName!==""?(r(),k("div",Ee,[a(d,{type:"warning",height:L()-72,title:e(l)("rooms.result.noResult.title"),"sub-title":e(l)("rooms.result.noResult.subTitle")},null,8,["height","title","sub-title"])])):_("",!0),e(S).length===0&&e(g).gameName===""?(r(),k("div",We,[a(d,{type:"warning",height:L()-72,title:e(l)("rooms.result.noRoom.title"),"sub-title":e(l)("rooms.result.noRoom.subTitle")},null,8,["height","title","sub-title"])])):_("",!0)],64)):(r(),k($,{key:1},[e(w).userInfo.role==="admin"?(r(),m(d,{key:0,title:e(l)("global.noGame.title"),"sub-title":e(l)("global.noGame.subTitle"),height:L(),type:"error"},{default:t(()=>[a(C,{to:"/install",class:"mt-4"},{default:t(()=>[c(i(e(l)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(r(),m(d,{key:1,title:e(l)("global.noGameNoAdmin.title"),"sub-title":e(l)("global.noGameNoAdmin.subTitle"),height:L(),type:"error"},null,8,["title","sub-title","height"]))],64)),a(ie,{modelValue:e(x),"onUpdate:modelValue":n[2]||(n[2]=o=>ze(x)?x.value=o:null),type:"warning",title:e(l)("global.confirm.title"),content:e(l)("global.confirm.content"),"confirm-text":e(l)("global.confirm.confirm"),"cancel-text":e(l)("global.confirm.cancel"),"confirm-loading":e(U),onConfirm:se,onCancel:n[3]||(n[3]=o=>x.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{_t as default};
