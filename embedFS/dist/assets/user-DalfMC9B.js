import{_ as fe}from"./ConfirmBox-qQUgNQN6.js";import{d as pe,e as ce,b as be,f as b,j as ve,c as L,o as i,a as l,w as a,p as O,l as e,ah as ge,x as q,ad as Ve,s as S,v as u,t as m,U as Q,W as X,J as N,A as f,F as j,z as v,B as Y,m as Z,R as ee,D as ae,V as le,ab as ye,q as xe,y as _e,C as ke,G as F,aC as re,S as Ce}from"./index-D0_VvR3J.js";import{u as R}from"./user-maltidi9.js";import{r as we}from"./room-L8Fn_wZk.js";import{V as Pe,a as Se,b as Ue,c as We,d as Be}from"./VBadge-C4cDh5dF.js";import{V as g}from"./VRow-T4pZZsdz.js";import{V as c}from"./VCol-B5VJ-k2B.js";import{V as A}from"./VTextField-BDhl3HoB.js";import{V as De}from"./VDataTableServer-B9QRhhh5.js";import{V as Te}from"./VMenu-gAht7neB.js";import{V as ze}from"./VList-B7_QlUC1.js";import{V as d}from"./VChip-Bl_XNOgC.js";import{V as Le,a as Fe}from"./VToolbar-BJcGoYLB.js";import{V as Re}from"./VForm-ZCkSOZOI.js";import{T as V}from"./index-9_CLTx8V.js";import{V as M,a as w}from"./VRadioGroup-BFGVeut_.js";import{V as Ae}from"./VSelect-DehtkG2o.js";import{V as oe}from"./VSlider-DNia88Rt.js";import{V as Ie}from"./VSpacer-BWidqFwK.js";import{V as $e}from"./VDialog-laDXRq-G.js";import"./VAlert-Cnu_GEOX.js";import"./axios-B3QxYxjQ.js";/* empty css              */import"./index-BYTG7FXw.js";import"./VInput-CQ0d1937.js";import"./VDataTable-DH4Ujgw6.js";import"./VPagination-_V6tKqvs.js";import"./VCheckboxBtn-DD1lUkrO.js";import"./VSelectionControl-KRPi77qu.js";import"./VTable-CvulZgfR.js";import"./filter-ujihALSj.js";import"./dialog-transition-Bnn_UDo8.js";import"./ssrBoot-CVvmSRtT.js";import"./VTooltip-DeNPgE8E.js";const qe={key:0},_a={__name:"user",setup(Ne){const h=pe(),{mobile:P}=ce(),{t:r}=be(),E=b([{roomName:"",roomID:0}]),te=()=>{we.basic.get().then(n=>{E.value=n.data||[]})},U=b(""),p=b({rows:[],page:1,pageSize:10,total:0}),W=b(!1),x=({page:n,itemsPerPage:t,sortBy:C})=>{const o={q:U.value,page:n,pageSize:t};W.value=!0,R.list.get(o).then(z=>{p.value=z.data}).finally(()=>{W.value=!1})},se=[{title:r("platform.user.form.username.title"),value:"username"},{title:r("platform.user.form.nickname.title"),value:"nickname"},{title:r("platform.user.form.role.title"),value:"role"},{title:r("platform.user.form.avatar.title"),value:"avatar"},{title:r("platform.user.form.disabled.title"),value:"disabled"},{title:r("platform.user.form.rooms.title"),value:"rooms"},{title:r("platform.user.form.roomCreation.title"),value:"roomCreation"},{title:r("platform.user.form.maxWorlds.title"),value:"maxWorlds"},{title:r("platform.user.form.maxPlayers.title"),value:"maxPlayers"},{title:r("platform.user.table.actions"),value:"actions"}],_=b(),s=b({username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!0,maxWorlds:2,maxPlayers:6}),I={username:[n=>n?!0:r("platform.user.form.username.required")],nickname:[n=>n?!0:r("platform.user.form.nickname.required")],password:[n=>n?!0:r("platform.user.form.password.required")]},y=b(!1),B=b(!1),ne=()=>{y.value=!0,B.value=!1,s.value={username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!1,maxWorlds:2,maxPlayers:6},re(()=>{_.value&&_.value.resetValidation()})},me={1:Be,2:We,3:Ue,4:Se},G=n=>me[n],D=b(!1),T=b(!1),ue=async()=>{const{valid:n}=await _.value.validate();if(n)if(T.value=!0,B.value){const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:"",disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};R.base.put(t).then(C=>{y.value=!1,F(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{T.value=!1})}else{const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:Ce(s.value.password),disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};R.base.post(t).then(C=>{y.value=!1,F(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{T.value=!1})}},K=n=>n?n.split(",").map(Number).filter(t=>!isNaN(t)):[],H=(n,t)=>{switch(n){case"update":ie(t);break;case"delete":J.value=t.username,k.value=!0;break;default:F("牛哇","error")}},ie=n=>{y.value=!0,B.value=!0,s.value={username:n.username,nickname:n.nickname,role:n.role,avatar:n.avatar,disabled:n.disabled,rooms:K(n.rooms),roomCreation:n.roomCreation,maxWorlds:n.maxWorlds,maxPlayers:n.maxPlayers},re(()=>{_.value&&_.value.resetValidation()})},k=b(!1),$=b(!1),J=b(""),de=()=>{$.value=!0;const n={username:J.value};R.base.delete(n).then(t=>{k.value=!1,F(t.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{$.value=!1})};return ve(()=>{te()}),(n,t)=>{const C=fe;return i(),L(j,null,[l(le,null,{default:a(()=>[l(O,null,{default:a(()=>[l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(A,{modelValue:e(U),"onUpdate:modelValue":t[0]||(t[0]=o=>q(U)?U.value=o:null),label:e(r)("platform.user.search.label"),placeholder:e(r)("platform.user.search.placeholder"),clearable:"",onKeyup:t[1]||(t[1]=ge(o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}),["enter"])),"onClick:clear":t[2]||(t[2]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},null,8,["modelValue","label","placeholder"])]),_:1}),l(c,{cols:"12"},{default:a(()=>[l(Ve,{rounded:"",border:""},{default:a(()=>[l(De,{"items-per-page":e(p).pageSize,"onUpdate:itemsPerPage":t[4]||(t[4]=o=>e(p).pageSize=o),items:e(p).rows,"items-length":e(p).total,page:e(p).page,loading:e(W),headers:se,"onUpdate:options":x},{top:a(()=>[l(Le,{flat:""},{default:a(()=>[l(Fe,null,{default:a(()=>[l(N,{icon:"ri-id-card-line",start:""}),e(P)?ae("",!0):(i(),L("span",qe,m(e(r)("platform.user.table.title")),1))]),_:1}),l(S,{"prepend-icon":"ri-add-line",color:"success",onClick:ne},{default:a(()=>[u(m(e(r)("platform.user.table.create")),1)]),_:1}),l(S,{"prepend-icon":"ri-refresh-line",loading:e(W),color:"default",onClick:t[3]||(t[3]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},{default:a(()=>[u(m(e(r)("platform.user.table.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.username":a(({value:o})=>[l(d,{label:""},{default:a(()=>[u(m(o),1)]),_:2},1024)]),"item.nickname":a(({value:o})=>[l(d,{label:""},{default:a(()=>[u(m(o),1)]),_:2},1024)]),"item.role":a(({value:o})=>[o==="admin"?(i(),f(d,{key:0,color:"primary",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.admin")),1)]),_:1})):(i(),f(d,{key:1,label:""},{default:a(()=>[u(m(e(r)("platform.user.table.nonAdmin")),1)]),_:1}))]),"item.avatar":a(({value:o})=>[v((i(),f(Y,{color:"primary",variant:"tonal"},{default:a(()=>[l(Z,{src:G(o)},null,8,["src"])]),_:2},1024)),[[ee]])]),"item.disabled":a(({value:o})=>[o?(i(),f(d,{key:0,color:"error",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.yes")),1)]),_:1})):(i(),f(d,{key:1,color:"success",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.no")),1)]),_:1}))]),"item.rooms":a(({item:o})=>[o.role==="admin"?(i(),f(d,{key:0,color:"success",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.noLimit")),1)]),_:1})):(i(),f(d,{key:1,color:"info",label:""},{default:a(()=>[u(m(K(o.rooms).length)+m(e(r)("platform.user.table.unit")),1)]),_:2},1024))]),"item.roomCreation":a(({item:o})=>[o.role==="admin"?(i(),f(d,{key:0,color:"success",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.yes")),1)]),_:1})):(i(),L(j,{key:1},[o.roomCreation?(i(),f(d,{key:0,color:"success",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.yes")),1)]),_:1})):(i(),f(d,{key:1,color:"error",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.no")),1)]),_:1}))],64))]),"item.maxWorlds":a(({item:o})=>[o.role==="admin"?(i(),f(d,{key:0,color:"success",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.noLimit")),1)]),_:1})):(i(),f(d,{key:1,label:""},{default:a(()=>[u(m(o.maxWorlds),1)]),_:2},1024))]),"item.maxPlayers":a(({item:o})=>[o.role==="admin"?(i(),f(d,{key:0,color:"success",label:""},{default:a(()=>[u(m(e(r)("platform.user.table.noLimit")),1)]),_:1})):(i(),f(d,{key:1,label:""},{default:a(()=>[u(m(o.maxPlayers),1)]),_:2},1024))]),"item.actions":a(({item:o})=>[l(S,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:a(()=>[u(m(e(r)("platform.user.table.actions"))+" ",1),l(Te,{activator:"parent"},{default:a(()=>[l(ze,null,{default:a(()=>[l(Q,{class:"text-warning",onClick:z=>H("update",o)},{prepend:a(()=>[l(N,{icon:"ri-user-settings-line",size:"22"})]),default:a(()=>[l(X,null,{default:a(()=>[u(m(e(r)("platform.user.table.update")),1)]),_:1})]),_:1},8,["onClick"]),l(Q,{disabled:o.role==="admin",class:"text-error",onClick:z=>H("delete",o)},{prepend:a(()=>[l(N,{icon:"ri-user-unfollow-line",size:"22"})]),default:a(()=>[l(X,null,{default:a(()=>[u(m(e(r)("platform.user.table.delete")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items-per-page","items","items-length","page","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l($e,{modelValue:e(y),"onUpdate:modelValue":t[16]||(t[16]=o=>q(y)?y.value=o:null),width:e(P)?"85%":"60%"},{default:a(()=>[l(le,null,{default:a(()=>[l(ye,null,{default:a(()=>[u(m(e(r)("platform.user.dialogTitle")),1)]),_:1}),l(Re,{ref_key:"userFormRef",ref:_,class:"mx-6",onSubmit:xe(ue,["prevent"])},{default:a(()=>[l(O,{class:"my-2"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[v(l(A,{modelValue:e(s).username,"onUpdate:modelValue":t[5]||(t[5]=o=>e(s).username=o),rules:I.username,label:e(r)("platform.user.form.username.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.username.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[v(l(A,{modelValue:e(s).nickname,"onUpdate:modelValue":t[6]||(t[6]=o=>e(s).nickname=o),rules:I.nickname,label:e(r)("platform.user.form.nickname.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.nickname.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12",md:"6"},{default:a(()=>[l(M,{modelValue:e(s).role,"onUpdate:modelValue":t[7]||(t[7]=o=>e(s).role=o),disabled:e(s).username===e(h).userInfo.username,inline:""},{prepend:a(()=>[v((i(),f(d,null,{default:a(()=>[u(m(e(r)("platform.user.form.role.title")),1)]),_:1})),[[V,e(r)("platform.user.form.role.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.role.admin"),value:"admin",class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.role.nonAdmin"),value:"non-admin",class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1}),l(c,{cols:"12",md:"6"},{default:a(()=>[l(M,{modelValue:e(s).disabled,"onUpdate:modelValue":t[8]||(t[8]=o=>e(s).disabled=o),disabled:e(s).username===e(h).userInfo.username,inline:""},{prepend:a(()=>[v((i(),f(d,null,{default:a(()=>[u(m(e(r)("platform.user.form.disabled.title")),1)]),_:1})),[[V,e(r)("platform.user.form.disabled.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.disabled.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.disabled.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:e(P)?4:2,class:"d-flex align-center"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[v((i(),f(d,null,{default:a(()=>[u(m(e(r)("platform.user.form.avatar.title")),1)]),_:1})),[[V,e(r)("platform.user.form.avatar.tip")]])]),_:1})]),_:1})]),_:1},8,["cols"]),l(c,{cols:e(P)?8:10},{default:a(()=>[l(g,null,{default:a(()=>[(i(),L(j,null,_e(4,o=>l(c,{key:o,cols:e(P)?6:3},{default:a(()=>[l(Pe,{dot:"",location:"bottom right","offset-x":"3","offset-y":"3",color:"success","model-value":e(s).avatar===o.toString()},{default:a(()=>[v((i(),f(Y,{color:"primary",variant:"tonal",onClick:z=>e(s).avatar=o.toString()},{default:a(()=>[l(Z,{src:G(o)},null,8,["src"])]),_:2},1032,["onClick"])),[[ee]])]),_:2},1032,["model-value"])]),_:2},1032,["cols"])),64))]),_:1})]),_:1},8,["cols"])]),_:1}),e(B)?ae("",!0):(i(),f(g,{key:0},{default:a(()=>[l(c,null,{default:a(()=>[v(l(A,{modelValue:e(s).password,"onUpdate:modelValue":t[9]||(t[9]=o=>e(s).password=o),"append-inner-icon":e(D)?"ri-eye-off-line":"ri-eye-line",type:e(D)?"text":"password",autocomplete:"password",label:e(r)("platform.user.form.password.title"),rules:I.password,clearable:"","onClick:appendInner":t[10]||(t[10]=o=>D.value=!e(D))},null,8,["modelValue","append-inner-icon","type","label","rules"]),[[V,e(r)("platform.user.form.password.tip")]])]),_:1})]),_:1})),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(M,{modelValue:e(s).roomCreation,"onUpdate:modelValue":t[11]||(t[11]=o=>e(s).roomCreation=o),disabled:e(s).role==="admin",inline:""},{prepend:a(()=>[v((i(),f(d,null,{default:a(()=>[u(m(e(r)("platform.user.form.roomCreation.title")),1)]),_:1})),[[V,e(r)("platform.user.form.roomCreation.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.roomCreation.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.roomCreation.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[v(l(Ae,{modelValue:e(s).rooms,"onUpdate:modelValue":t[12]||(t[12]=o=>e(s).rooms=o),disabled:e(s).role==="admin",items:e(E),"item-title":"roomName","item-value":"roomID",label:e(r)("platform.user.form.rooms.title"),multiple:"",chips:""},null,8,["modelValue","disabled","items","label"]),[[V,e(r)("platform.user.form.rooms.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(oe,{modelValue:e(s).maxPlayers,"onUpdate:modelValue":t[13]||(t[13]=o=>e(s).maxPlayers=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[v((i(),f(d,{style:{"margin-right":"1rem"}},{default:a(()=>[u(m(e(r)("platform.user.form.maxPlayers.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxPlayers.tip")]])]),append:a(()=>[l(d,{label:"",color:"primary"},{default:a(()=>[u(m(e(s).maxPlayers),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(oe,{modelValue:e(s).maxWorlds,"onUpdate:modelValue":t[14]||(t[14]=o=>e(s).maxWorlds=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[v((i(),f(d,{style:{"margin-right":"1rem"}},{default:a(()=>[u(m(e(r)("platform.user.form.maxWorlds.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxWorlds.tip")]])]),append:a(()=>[l(d,{label:"",color:"primary"},{default:a(()=>[u(m(e(s).maxWorlds),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(ke,{class:"my-6"},{default:a(()=>[l(Ie),l(S,{color:"default",variant:"elevated",text:e(r)("login.cancel"),class:"mr-4",onClick:t[15]||(t[15]=o=>y.value=!1)},null,8,["text"]),l(S,{text:e(r)("login.submit"),loading:e(T),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"]),l(C,{modelValue:e(k),"onUpdate:modelValue":t[17]||(t[17]=o=>q(k)?k.value=o:null),type:"warning",title:e(r)("global.confirm.title"),content:e(r)("global.confirm.content"),"confirm-text":e(r)("global.confirm.confirm"),"cancel-text":e(r)("global.confirm.cancel"),"confirm-loading":e($),onConfirm:de,onCancel:t[18]||(t[18]=o=>k.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{_a as default};
