import{_ as K}from"./Result-gWT-ossO.js";import{g as P,d as Q,b as X,e as Y,f as c,j as ee,a8 as te,a9 as oe,c as y,o as d,a as o,l as e,F as T,A as p,w as t,ad as ne,s as v,v as m,t as s,U as G,W as M,J as D,Z as le,D as ae,V as $,q as se,ab as ie,k as q,p as re,z as F,C as ue,x as de,aC as me,G as B,cA as ce}from"./index-D0_VvR3J.js";import{t as R}from"./tools-B2389Z04.js";import{V as fe}from"./VDataTable-DH4Ujgw6.js";import{V as pe}from"./VMenu-gAht7neB.js";import{V as ve}from"./VList-B7_QlUC1.js";import{V as k}from"./VChip-Bl_XNOgC.js";import{V as Ve,a as ge}from"./VToolbar-BJcGoYLB.js";import{V as be}from"./VSkeletonLoader-DlxWhbhq.js";import{V as _e}from"./VForm-ZCkSOZOI.js";import{V as A}from"./VRow-T4pZZsdz.js";import{V as he,a as E}from"./VRadioGroup-BFGVeut_.js";import{T as I}from"./index-9_CLTx8V.js";import{V as ye}from"./VNumberInput-ChTB30Zu.js";import{V as ke}from"./VTextField-BDhl3HoB.js";import{V as we}from"./VSpacer-BWidqFwK.js";import{V as Se}from"./VDialog-laDXRq-G.js";import"./VContainer-BdgJJao2.js";/* empty css              */import"./axios-B3QxYxjQ.js";import"./VPagination-_V6tKqvs.js";import"./VSelect-DehtkG2o.js";import"./VInput-CQ0d1937.js";import"./index-BYTG7FXw.js";import"./VCheckboxBtn-DD1lUkrO.js";import"./VSelectionControl-KRPi77qu.js";import"./dialog-transition-Bnn_UDo8.js";import"./VTable-CvulZgfR.js";import"./filter-ujihALSj.js";import"./ssrBoot-CVvmSRtT.js";import"./VTooltip-DeNPgE8E.js";const xe={key:0},Ce={style:{width:"50px"}},at={__name:"announce",setup(Te){const V=P(),J=Q(),{t:n}=X(),{mobile:N}=Y(),L=c(window.innerHeight),f=c([]),b=c(!1),_=()=>{if(V.room.id===0)return;b.value=!0;const r={roomID:V.room.id};R.announce.get(r).then(a=>{a.data!==""&&(f.value=JSON.parse(a.data))}).finally(()=>{b.value=!1})},H=[{key:"status",title:n("tools.announce.form.status.title")},{key:"interval",title:n("tools.announce.form.interval.title"),minWidth:120},{key:"content",title:n("tools.announce.form.content.title")},{key:"actions",title:n("tools.announce.actions")}],g=c(!1),w=c(!1),U=(r,a=!1)=>{a?(w.value=!0,i.value={...r}):(w.value=!1,i.value={id:"",status:!0,interval:600,content:""}),me(()=>{h.value&&h.value.resetValidation()}),g.value=!0},h=c(),i=c({id:"",status:!0,interval:600,content:""}),O=c({content:[r=>r?r.includes('"')||r.includes("'")?n("tools.announce.form.content.rule"):!0:n("tools.announce.form.content.required")]}),S=c(!1),W=async()=>{const{valid:r}=await h.value.validate();if(r){if(i.value.content=i.value.content.replace(/['"]/g,""),w.value){for(let u=0;u<f.value.length;u++)if(f.value[u].id===i.value.id){f.value[u]=i.value;break}}else S.value=!0,i.value.id=ce(),f.value.push(i.value);const a={roomID:V.room.id,setting:JSON.stringify(f.value)};R.announce.put(a).then(u=>{B(u.message),g.value=!1,_()}).finally(()=>{S.value=!1})}},x=c(!1),j=r=>{x.value=!0;const a=f.value.filter(l=>l.id!==r),u={roomID:V.room.id,setting:JSON.stringify(a)};R.announce.put(u).then(l=>{B(n("tools.announce.deleteMessage")),_()}).finally(()=>{x.value=!1})},z=te(()=>{L.value=window.innerHeight},200),C=()=>Math.max(2,Math.floor(L.value-150));return ee(()=>{window.addEventListener("resize",z),_()}),oe(()=>{window.removeEventListener("resize",z)}),(r,a)=>{const u=K;return d(),y(T,null,[e(V).gameVersion.local!==0?(d(),y(T,{key:0},[e(V).room.id!==0?(d(),p($,{key:0},{default:t(()=>[o(ne,{border:"",rounded:""},{default:t(()=>[o(fe,{headers:H,items:e(f),loading:e(b)},{loading:t(()=>[o(be,{type:"table-row@10"})]),top:t(()=>[o(Ve,{flat:""},{default:t(()=>[o(ge,null,{default:t(()=>[o(D,{icon:"ri-chat-smile-ai-3-line",start:""}),e(N)?ae("",!0):(d(),y("span",xe,s(e(n)("tools.announce.title")),1))]),_:1}),o(v,{"prepend-icon":"ri-add-line",color:"success",onClick:U},{default:t(()=>[m(s(e(n)("tools.announce.add")),1)]),_:1}),o(v,{"prepend-icon":"ri-refresh-line",loading:e(b),color:"default",onClick:_},{default:t(()=>[m(s(e(n)("tools.announce.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.status":t(({value:l})=>[l?(d(),p(k,{key:0,label:"",color:"success"},{default:t(()=>[m(s(e(n)("tools.announce.form.status.y")),1)]),_:1})):(d(),p(k,{key:1,label:"",color:"error"},{default:t(()=>[m(s(e(n)("tools.announce.form.status.n")),1)]),_:1}))]),"item.interval":t(({value:l})=>[o(k,{label:""},{default:t(()=>[m(s(l),1)]),_:2},1024)]),"item.content":t(({value:l})=>[m(s(e(le)(l,40)),1)]),"item.actions":t(({item:l})=>[o(v,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:e(x)},{default:t(()=>[m(s(e(n)("tools.announce.actions"))+" ",1),o(pe,{activator:"parent"},{default:t(()=>[o(ve,null,{default:t(()=>[o(G,{class:"text-info",onClick:Z=>U(l,!0)},{prepend:t(()=>[o(D,{icon:"ri-edit-line",size:"22"})]),default:t(()=>[o(M,null,{default:t(()=>[m(s(e(n)("tools.announce.update")),1)]),_:1})]),_:1},8,["onClick"]),o(G,{class:"text-error",onClick:Z=>j(l.id)},{prepend:t(()=>[o(D,{icon:"ri-delete-bin-line",size:"22"})]),default:t(()=>[o(M,null,{default:t(()=>[m(s(e(n)("tools.announce.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["items","loading"])]),_:1})]),_:1})):(d(),p(u,{key:1,title:e(n)("global.noRoomSelected.title"),"sub-title":e(n)("global.noRoomSelected.subTitle"),type:"error",height:C()},{default:t(()=>[o(v,{to:"/rooms",class:"mt-4"},{default:t(()=>[m(s(e(n)("global.noRoomSelected.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(d(),y(T,{key:1},[e(J).userInfo.role==="admin"?(d(),p(u,{key:0,title:e(n)("global.noGame.title"),"sub-title":e(n)("global.noGame.subTitle"),height:C(),type:"error"},{default:t(()=>[o(v,{to:"/install",class:"mt-4"},{default:t(()=>[m(s(e(n)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(d(),p(u,{key:1,title:e(n)("global.noGameNoAdmin.title"),"sub-title":e(n)("global.noGameNoAdmin.subTitle"),height:C(),type:"error"},null,8,["title","sub-title","height"]))],64)),o(Se,{modelValue:e(g),"onUpdate:modelValue":a[4]||(a[4]=l=>de(g)?g.value=l:null),width:e(N)?"90%":"60%"},{default:t(()=>[o($,null,{default:t(()=>[o(_e,{ref_key:"announceFormRef",ref:h,class:"ma-4",onSubmit:se(W,["prevent"])},{default:t(()=>[o(ie,null,{default:t(()=>[q("span",null,s(e(n)("tools.announce.title")),1)]),_:1}),o(re,{class:"my-8"},{default:t(()=>[o(A,{class:"mb-8"},{default:t(()=>[o(he,{modelValue:e(i).status,"onUpdate:modelValue":a[0]||(a[0]=l=>e(i).status=l),inline:""},{prepend:t(()=>[F((d(),p(k,null,{default:t(()=>[m(s(e(n)("tools.announce.form.status.title")),1)]),_:1})),[[I,e(n)("tools.announce.form.status.tip")]])]),default:t(()=>[o(E,{label:e(n)("tools.announce.form.status.y"),value:!0,class:"mr-4"},null,8,["label"]),o(E,{label:e(n)("tools.announce.form.status.n"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),o(A,{class:"mb-8"},{default:t(()=>[F((d(),p(ye,{modelValue:e(i).interval,"onUpdate:modelValue":a[1]||(a[1]=l=>e(i).interval=l),label:e(n)("tools.announce.form.interval.title"),min:1,style:{"margin-bottom":"-1.25rem"}},{"append-inner":t(()=>[q("div",Ce,s(e(n)("tools.announce.form.interval.unit")),1)]),_:1},8,["modelValue","label"])),[[I,e(n)("tools.announce.form.interval.tip")]])]),_:1}),o(A,null,{default:t(()=>[F(o(ke,{modelValue:e(i).content,"onUpdate:modelValue":a[2]||(a[2]=l=>e(i).content=l),label:e(n)("tools.announce.form.content.title"),rules:e(O).content},null,8,["modelValue","label","rules"]),[[I,e(n)("tools.announce.form.content.tip")]])]),_:1})]),_:1}),o(ue,null,{default:t(()=>[o(we),o(v,{color:"default",variant:"elevated",text:e(n)("login.cancel"),class:"mr-4",onClick:a[3]||(a[3]=l=>g.value=!1)},null,8,["text"]),o(v,{text:e(n)("login.submit"),loading:e(S),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"])],64)}}};export{at as default};
