import{_ as ee}from"./Result-gWT-ossO.js";import $ from"./log-CdWSXfEQ.js";import{l as R}from"./logs-BPuWEDqr.js";import{r as te}from"./room-L8Fn_wZk.js";import{g as le,d as oe,e as ae,b as se,f as n,j as ie,a8 as ne,Q as re,c as C,l as e,o as s,A as m,F as I,a as o,w as a,v as b,t as g,x as p,V as E,ab as P,k as w,p as W,D,s as U}from"./index-D0_VvR3J.js";import{c as j,d as ue,e as z,f as de}from"./VTabs-BDSGrPgI.js";import{V as q}from"./VSelect-DehtkG2o.js";import{V as me}from"./VSwitch-CIENX7Ym.js";import{V as ce}from"./VChip-Bl_XNOgC.js";import{V as ge}from"./VRow-T4pZZsdz.js";import{V as fe}from"./VSpacer-BWidqFwK.js";import{V as he}from"./VCol-B5VJ-k2B.js";import{V as pe}from"./VNumberInput-ChTB30Zu.js";import"./VContainer-BdgJJao2.js";/* empty css              */import"./preview-CwSUJBLr.js";import"./axios-B3QxYxjQ.js";import"./ssrBoot-CVvmSRtT.js";import"./VInput-CQ0d1937.js";import"./index-BYTG7FXw.js";import"./VTextField-BDhl3HoB.js";import"./VList-B7_QlUC1.js";import"./VMenu-gAht7neB.js";import"./dialog-transition-Bnn_UDo8.js";import"./VCheckboxBtn-DD1lUkrO.js";import"./VSelectionControl-KRPi77qu.js";const ve={class:"card-header"},ye={class:"fcc"},Ve={class:"card-header"},be={class:"fcc"},Je={__name:"game",setup(we){const f=le(),Q=oe(),{mobile:J}=ae(),{t:l}=se(),v=n("current"),y=n(""),d=n(0),T=n(!0),V=n(0),K=u=>{u==="current"&&(N.value=!0),u==="history"&&(N.value=!1)},S=n(!1),N=n(!0),B=()=>{if(d.value===0||!N.value)return;const u={roomID:f.room.id,worldID:d.value,logType:"game",lines:V.value};R.content.get(u).then(t=>{t.data===null?y.value="":y.value=t.data.join(`
`),S.value=!0})},F=n([]),O=async()=>{const u={roomID:f.room.id},t=await te.worlds.get(u);F.value=t.data,d.value=F.value[0]?.id||0},H=n([]),X=()=>{const u={roomID:f.room.id,worldID:d.value,logType:"game"};R.history.list.get(u).then(t=>{H.value=t.data})},_=n(""),k=n(""),h=n(!1),Y=()=>{h.value=!0;const u={roomID:f.room.id,worldID:d.value,logType:"game",logFile:_.value};R.history.content.get(u).then(t=>{k.value="",k.value=t.data}).finally(()=>{h.value=!1})};let x=null;const Z=()=>{x=setInterval(()=>{T.value&&B()},2e3)},M=()=>{x&&(clearInterval(x),x=null)},A=()=>Math.round(Math.max(2,Math.floor(L.value-427))/22.5),r=()=>Math.max(2,Math.floor(L.value-160-37)),L=n(window.innerHeight),G=ne(()=>{L.value=window.innerHeight,V.value=A()},200);return ie(async()=>{f.room.id!==0&&(window.addEventListener("resize",G),await O(),X(),V.value=A(),Z())}),re(()=>{M(),window.removeEventListener("beforeunload",M),window.removeEventListener("resize",G)}),(u,t)=>{const c=ee;return e(f).gameVersion.local!==0?(s(),C(I,{key:0},[e(f).room.id!==0?(s(),C(I,{key:0},[o(ue,{modelValue:e(v),"onUpdate:modelValue":[t[0]||(t[0]=i=>p(v)?v.value=i:null),K],"align-tabs":"start",color:"primary","show-arrows":""},{default:a(()=>[o(j,{value:"current"},{default:a(()=>[b(g(e(l)("logs.current")),1)]),_:1}),o(j,{value:"history"},{default:a(()=>[b(g(e(l)("logs.history")),1)]),_:1})]),_:1},8,["modelValue"]),o(de,{modelValue:e(v),"onUpdate:modelValue":t[8]||(t[8]=i=>p(v)?v.value=i:null),class:"mt-4"},{default:a(()=>[o(z,{value:"current"},{default:a(()=>[o(E,{height:r()},{default:a(()=>[o(P,{class:"my-2"},{default:a(()=>[w("div",ve,[w("span",null,g(e(l)("logs.current")),1),w("div",ye,[o(q,{modelValue:e(d),"onUpdate:modelValue":[t[1]||(t[1]=i=>p(d)?d.value=i:null),t[2]||(t[2]=i=>{y.value="",S.value=!1})],items:e(F),"item-title":"worldName","item-value":"id",label:e(l)("logs.world"),density:"compact",class:"mr-4"},null,8,["modelValue","items","label"]),o(me,{modelValue:e(T),"onUpdate:modelValue":t[3]||(t[3]=i=>p(T)?T.value=i:null),color:"info","hide-details":""},{prepend:a(()=>[o(ce,{color:"info"},{default:a(()=>[b(g(e(l)("logs.autoPull")),1)]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),o(W,null,{default:a(()=>[e(S)?(s(),C(I,{key:0},[e(y)?(s(),m($,{key:0,content:e(y),height:r()-150},null,8,["content","height"])):(s(),m(c,{key:1,type:"info",height:r()-150,title:e(l)("logs.noContent")},null,8,["height","title"]))],64)):(s(),m(c,{key:1,type:"info",title:e(l)("logs.fetching"),height:r()-150},null,8,["title","height"])),o(ge,{class:"my-4"},{default:a(()=>[e(J)?D("",!0):(s(),m(fe,{key:0})),o(he,{class:"d-flex align-center justify-end"},{default:a(()=>[o(pe,{modelValue:e(V),"onUpdate:modelValue":t[4]||(t[4]=i=>p(V)?V.value=i:null),label:e(l)("logs.line"),"hide-details":"",density:"compact",class:"mr-4","max-width":"120"},null,8,["modelValue","label"]),o(U,{onClick:B},{default:a(()=>[b(g(e(l)("logs.pull")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["height"])]),_:1}),o(z,{value:"history"},{default:a(()=>[o(E,{height:r()},{default:a(()=>[o(P,{class:"my-2"},{default:a(()=>[w("div",Ve,[w("span",null,g(e(l)("logs.history")),1),w("div",be,[o(q,{modelValue:e(d),"onUpdate:modelValue":[t[5]||(t[5]=i=>p(d)?d.value=i:null),t[6]||(t[6]=i=>y.value="")],items:e(F),"item-title":"worldName","item-value":"id",label:e(l)("logs.world"),density:"compact",class:"mr-4","min-width":"100px"},null,8,["modelValue","items","label"]),o(q,{modelValue:e(_),"onUpdate:modelValue":[t[7]||(t[7]=i=>p(_)?_.value=i:null),Y],items:e(H),disabled:e(h),loading:e(h),label:e(l)("logs.logFile"),density:"compact","min-width":"100px"},null,8,["modelValue","items","disabled","loading","label"])])])]),_:1}),o(W,null,{default:a(()=>[e(_)?(s(),C(I,{key:0},[!e(h)&&e(k)?(s(),m($,{key:0,content:e(k),height:r()-150},null,8,["content","height"])):D("",!0),e(h)?(s(),m(c,{key:1,type:"info",title:e(l)("logs.fetching"),height:r()-150},null,8,["title","height"])):D("",!0),!e(h)&&!e(k)?(s(),m(c,{key:2,type:"info",height:r()-150,title:e(l)("logs.noContent")},null,8,["height","title"])):D("",!0)],64)):(s(),m(c,{key:1,type:"info",height:r()-150,title:e(l)("logs.noLogFile")},null,8,["height","title"]))]),_:1})]),_:1},8,["height"])]),_:1})]),_:1},8,["modelValue"])],64)):(s(),m(c,{key:1,title:e(l)("global.noRoomSelected.title"),"sub-title":e(l)("global.noRoomSelected.subTitle"),type:"error",height:r()},{default:a(()=>[o(U,{to:"/rooms",class:"mt-4"},{default:a(()=>[b(g(e(l)("global.noRoomSelected.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(s(),C(I,{key:1},[e(Q).userInfo.role==="admin"?(s(),m(c,{key:0,title:e(l)("global.noGame.title"),"sub-title":e(l)("global.noGame.subTitle"),height:r(),type:"error"},{default:a(()=>[o(U,{to:"/install",class:"mt-4"},{default:a(()=>[b(g(e(l)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(s(),m(c,{key:1,title:e(l)("global.noGameNoAdmin.title"),"sub-title":e(l)("global.noGameNoAdmin.subTitle"),height:r(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{Je as default};
