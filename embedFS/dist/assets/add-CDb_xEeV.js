import{_ as ae}from"./Result-gWT-ossO.js";import{m as p}from"./mod-CZ879SoE.js";import{g as le,e as oe,b as de,f as n,j as te,A as g,o as f,w as e,a,ab as T,k as C,v as i,t as r,l as s,s as F,U as b,W as w,J as V,V as P,p as j,c as re,ag as se,F as ie,y as ne,C as ue,ad as me,D as A,ae as ce,m as fe,af as pe,G as v}from"./index-D0_VvR3J.js";import{r as ge}from"./room-L8Fn_wZk.js";import{V as G}from"./VMenu-gAht7neB.js";import{V as W}from"./VList-B7_QlUC1.js";import{V as ve}from"./VDialog-laDXRq-G.js";import{V as _e}from"./VAlert-Cnu_GEOX.js";import{V as _}from"./VChip-Bl_XNOgC.js";import{V as be}from"./VTextField-BDhl3HoB.js";import{V as we}from"./VDataTable-DH4Ujgw6.js";import{V as Ve}from"./VSkeletonLoader-DlxWhbhq.js";import"./VContainer-BdgJJao2.js";/* empty css              */import"./axios-B3QxYxjQ.js";import"./dialog-transition-Bnn_UDo8.js";import"./index-BYTG7FXw.js";import"./ssrBoot-CVvmSRtT.js";import"./VInput-CQ0d1937.js";import"./VPagination-_V6tKqvs.js";import"./VSelect-DehtkG2o.js";import"./VCheckboxBtn-DD1lUkrO.js";import"./VSelectionControl-KRPi77qu.js";import"./VTable-CvulZgfR.js";import"./filter-ujihALSj.js";const he={class:"card-header"},De={class:"card-header"},ke={class:"d-flex align-center justify-center fill-height"},Re={__name:"add",setup(ye){const c=le(),{mobile:J}=oe(),{t}=de(),E=n([]),h=n(!1),z=()=>{const o={roomID:c.room.id};h.value=!0,p.downloaded.get(o).then(d=>{E.value=d.data||[]}).finally(()=>{h.value=!1})},L=n(""),H=[{key:"preview_url",title:t("game.mod.add.preview")},{key:"name",title:t("game.mod.add.name")},{key:"serverSize",title:t("game.mod.add.size")},{key:"id",title:"ID"},{key:"update",title:t("game.mod.add.update")},{key:"actions",title:t("game.mod.add.actions")}],D=n([]),I=(o,d)=>{switch(o){case"enable":K(d);break;case"update":O(d);break;case"delete":ee(d);break;default:v("牛哇","error")}},U=n(!1),K=o=>{U.value=!0;const d={roomID:c.room.id,worldID:0,id:o.id,file_url:o.file_url};p.add.enable.post(d).then(u=>{v(u.message)}).finally(()=>{U.value=!1})},$=n(!1),O=o=>{$.value=!0;const d={roomID:c.room.id,id:o.id,file_url:o.file_url,update:!0,name:o.name,size:o.serverSize};p.download.post(d).then(u=>{v(u.message),z()}).finally(()=>{$.value=!1})},k=n(!1),Q=async()=>{let o=!0;k.value=!0;for(let d of D.value){const u={roomID:c.room.id,worldID:0,id:d.id,file_url:d.file_url};try{await p.add.enable.post(u)}catch{o=!1,v(`${d.name} ${t("game.mod.add.enableMultiFail")}`,"error")}}o&&(D.value=[],v(t("game.mod.add.enableMultiSuccess"))),k.value=!1},y=n(!1),M=n(0),R=async()=>{y.value=!0;for(let o=0;o<m.value.length;o++){const d={roomID:c.room.id,id:m.value[o].id,file_url:m.value[o].file_url,update:!1,name:m.value[o].name,size:m.value[o].size};try{const u=await p.download.post(d);m.value[o].color="success",M.value=(o+1)/m.value.length*100}catch{v(`${m.value[o].name} ${t("game.mod.add.preDownloadFail")}`,"error")}}M.value=100,y.value=!1},q=n(!1),S=n(!1),X=()=>{q.value=!0,S.value=!0,Z().finally(()=>{S.value=!1})},m=n([]),N=n([]),Y=async()=>{const o={roomID:c.room.id},d=await ge.worlds.get(o);N.value=d.data},Z=async()=>{m.value=[];const o={roomID:c.room.id,worldID:N.value[0]?.id},u=(await p.setting.enabledMods.get(o)).data||[];for(let l of u){l.color="default";const x={id:l.id,name:l.name,file_url:l.file_url,size:l.serverSize};m.value.push(x)}},B=n(!1),ee=o=>{B.value=!0;const d={roomID:c.room.id,id:o.id,file_url:o.file_url};p.delete.post(d).then(u=>{v(u.message),z()}).finally(()=>{B.value=!1})};return te(()=>{Y(),z()}),(o,d)=>{const u=ae;return f(),g(P,null,{default:e(()=>[a(T,null,{default:e(()=>[C("div",he,[i(r(s(t)("game.mod.add.tabName"))+" ",1),C("div",null,[a(F,{"append-icon":"ri-arrow-drop-down-line",loading:k.value,color:"primary"},{default:e(()=>[i(r(s(t)("game.mod.add.headerMenuButton"))+" ",1),a(G,{activator:"parent"},{default:e(()=>[a(W,null,{default:e(()=>[a(b,{disabled:y.value,class:"text-info",onClick:X},{prepend:e(()=>[a(V,{icon:"ri-download-2-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(r(s(t)("game.mod.add.preDownload")),1)]),_:1})]),_:1},8,["disabled"]),a(b,{disabled:D.value.length===0||k.value,class:"text-success",onClick:Q},{prepend:e(()=>[a(V,{icon:"ri-list-check-3",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(r(s(t)("game.mod.add.enableMulti")),1)]),_:1})]),_:1},8,["disabled"]),a(b,{disabled:k.value,class:"text-warning",onClick:d[0]||(d[0]=l=>I("enable",{id:0,file_url:""}))},{prepend:e(()=>[a(V,{icon:"ri-add-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(r(s(t)("game.mod.add.addClientModsDisabled")),1)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["loading"]),a(ve,{modelValue:q.value,"onUpdate:modelValue":d[2]||(d[2]=l=>q.value=l),persistent:y.value,width:s(J)?"90%":"40%"},{default:e(()=>[a(P,{"min-height":"300"},{default:e(()=>[a(T,null,{default:e(()=>[C("div",De,[C("span",null,r(s(t)("game.mod.add.preDownloadDialog.title")),1),a(F,{disabled:S.value,loading:y.value,onClick:R},{default:e(()=>[i(r(s(t)("game.mod.add.preDownloadDialog.button")),1)]),_:1},8,["disabled","loading"])])]),_:1}),S.value?(f(),g(ue,{key:1},{default:e(()=>[a(u,{height:230,color:"info",title:s(t)("game.mod.setting.tip.fetching")},null,8,["title"])]),_:1})):(f(),g(j,{key:0},{default:e(()=>[a(_e,{color:"warning",density:"compact",class:"mt-2 mb-4"},{default:e(()=>[i(r(s(t)("game.mod.add.preDownloadDialog.tip")),1)]),_:1}),a(se,{modelValue:M.value,"onUpdate:modelValue":d[1]||(d[1]=l=>M.value=l),color:"info",height:"12",rounded:"","rounded-bar":"",class:"mb-4"},null,8,["modelValue"]),(f(!0),re(ie,null,ne(m.value,l=>(f(),g(_,{key:l.id,color:l.color,label:"",class:"mr-4 mt-4"},{default:e(()=>[i(r(l.name),1)]),_:2},1032,["color"]))),128))]),_:1}))]),_:1})]),_:1},8,["modelValue","persistent","width"])])])]),_:1}),a(j,{class:"mt-4"},{default:e(()=>[a(be,{modelValue:L.value,"onUpdate:modelValue":d[3]||(d[3]=l=>L.value=l),loading:h.value,label:s(t)("game.mod.add.search"),variant:"outlined","hide-details":"","single-line":""},{append:e(()=>[a(F,{loading:h.value,"prepend-icon":"ri-refresh-line",color:"default",variant:"elevated",size:"large",onClick:z},{default:e(()=>[i(r(s(t)("game.mod.add.refresh")),1)]),_:1},8,["loading"])]),_:1},8,["modelValue","loading","label"]),a(me,{border:"",rounded:"",class:"mt-4"},{default:e(()=>[a(we,{modelValue:D.value,"onUpdate:modelValue":d[4]||(d[4]=l=>D.value=l),"show-select":"","return-object":"",headers:H,items:E.value,search:L.value,loading:h.value},{loading:e(()=>[a(Ve,{type:"table-row@10"})]),"item.preview_url":e(({value:l})=>[a(fe,{src:l,width:100,cover:"",rounded:"","aspect-ratio":"1",class:"ma-2"},{placeholder:e(()=>[C("div",ke,[a(pe,{color:"grey-lighten-4",indeterminate:""})])]),_:1},8,["src"])]),"item.name":e(({value:l})=>[a(_,{label:"",color:"info"},{default:e(()=>[i(r(l),1)]),_:2},1024)]),"item.serverSize":e(({value:l})=>[a(_,{label:"",color:"primary"},{default:e(()=>[i(r(s(ce)(parseInt(l))),1)]),_:2},1024)]),"item.id":e(({value:l})=>[a(_,{label:""},{default:e(()=>[i(r(l),1)]),_:2},1024)]),"item.update":e(({item:l})=>[l.file_url!==""?(f(),g(_,{key:0,label:""},{default:e(()=>[i(r(s(t)("game.mod.add.notUGC")),1)]),_:1})):A("",!0),l.file_url===""&&l.serverSize===l.localSize?(f(),g(_,{key:1,label:"",color:"success"},{default:e(()=>[i(r(s(t)("game.mod.add.needNoUpdate")),1)]),_:1})):A("",!0),l.file_url===""&&l.serverSize!==l.localSize?(f(),g(_,{key:2,label:"",color:"error"},{default:e(()=>[i(r(s(t)("game.mod.add.needUpdate")),1)]),_:1})):A("",!0)]),"item.actions":e(({item:l})=>[a(F,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:e(()=>[i(r(s(t)("game.mod.add.actions"))+" ",1),a(G,{activator:"parent"},{default:e(()=>[a(W,null,{default:e(()=>[a(b,{disabled:U.value,class:"text-success",onClick:x=>I("enable",l)},{prepend:e(()=>[a(V,{icon:"ri-file-check-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(r(s(t)("game.mod.add.enable")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(b,{disabled:$.value,class:"text-info",onClick:x=>I("update",l)},{prepend:e(()=>[a(V,{icon:"ri-arrow-up-circle-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(r(s(t)("game.mod.add.updateMod")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(b,{disabled:B.value,class:"text-error",onClick:x=>I("delete",l)},{prepend:e(()=>[a(V,{icon:"ri-delete-bin-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(r(s(t)("game.mod.add.deleteMod")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","items","search","loading"])]),_:1})]),_:1})]),_:1})}}};export{Re as default};
