import{_ as j}from"./Result-gWT-ossO.js";import{t as b}from"./tools-B2389Z04.js";import{g as J,d as K,b as W,e as O,f as d,j as P,a8 as Q,a9 as X,c as F,l as t,o as p,A as v,w as e,a,x as Y,s as k,v as r,t as i,U as N,W as S,J as y,aK as Z,ae as ee,D as M,ad as te,F as q,G as V}from"./index-D0_VvR3J.js";import{V as oe}from"./VDataTable-DH4Ujgw6.js";import{V as ae}from"./VMenu-gAht7neB.js";import{V as le}from"./VList-B7_QlUC1.js";import{V as w}from"./VChip-Bl_XNOgC.js";import{V as se,a as ie}from"./VToolbar-BJcGoYLB.js";import{V as ne}from"./VSkeletonLoader-DlxWhbhq.js";import"./VContainer-BdgJJao2.js";/* empty css              */import"./axios-B3QxYxjQ.js";import"./VPagination-_V6tKqvs.js";import"./VSelect-DehtkG2o.js";import"./VInput-CQ0d1937.js";import"./index-BYTG7FXw.js";import"./VTextField-BDhl3HoB.js";import"./VCheckboxBtn-DD1lUkrO.js";import"./VSelectionControl-KRPi77qu.js";import"./dialog-transition-Bnn_UDo8.js";import"./VTable-CvulZgfR.js";import"./filter-ujihALSj.js";import"./ssrBoot-CVvmSRtT.js";const re={key:0},xe={__name:"backup",setup(ue){const u=J(),G=K(),{t:o}=W(),{mobile:z}=O(),I=d(window.innerHeight),h=d(!1),B=d([]),g=()=>{if(u.room.id===0)return;h.value=!0;const n={roomID:u.room.id};b.backup.get(n).then(l=>{B.value=l.data,B.value.sort((m,s)=>s.timestamp-m.timestamp)}).finally(()=>{h.value=!1})},f=d([]),$=[{key:"gameName",title:o("tools.backup.gameName")},{key:"cycles",title:o("tools.backup.cycles")},{key:"size",title:o("tools.backup.size")},{key:"timestamp",title:o("tools.backup.timestamp")},{key:"actions",title:o("tools.backup.actions")}],c=d(!1),C=d(!1),R=()=>{C.value=!0;const n={roomID:u.room.id};b.backup.post(n).then(l=>{g(),V(l.message)}).finally(()=>{C.value=!1})},_=d(!1),A=n=>{_.value=!0,c.value=!0;const l={roomID:u.room.id,filenames:[n]};b.backup.delete(l).then(m=>{g(),V(o("tools.backup.deleteMessage1")+m.data+o("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,c.value=!1})},E=()=>{_.value=!0,c.value=!0;const n={roomID:u.room.id,filenames:f.value.map(l=>l.fileName)};b.backup.delete(n).then(l=>{g(),f.value=[],V(o("tools.backup.deleteMessage1")+l.data+o("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,c.value=!1})},L=d(!1),H=n=>{c.value=!0,L.value=!0;const l={roomID:u.room.id,filename:n};b.backup.restore.post(l).then(m=>{V(m.message)}).finally(()=>{L.value=!1,c.value=!1})},U=n=>{c.value=!0;const l={roomID:u.room.id,filename:n};b.backup.download.download(l,"dmp_backup.zip").finally(()=>{c.value=!1})},x=Q(()=>{I.value=window.innerHeight},200),D=()=>Math.max(2,Math.floor(I.value-150));return P(()=>{window.addEventListener("resize",x),g()}),X(()=>{window.removeEventListener("resize",x)}),(n,l)=>{const m=j;return t(u).gameVersion.local!==0?(p(),F(q,{key:0},[t(u).room.id!==0?(p(),v(te,{key:0,border:"",rounded:""},{default:e(()=>[a(oe,{modelValue:t(f),"onUpdate:modelValue":l[0]||(l[0]=s=>Y(f)?f.value=s:null),"show-select":"","return-object":"",headers:$,items:t(B),loading:t(h)},{loading:e(()=>[a(ne,{type:"table-row@10"})]),top:e(()=>[a(se,{flat:""},{default:e(()=>[a(ie,null,{default:e(()=>[a(y,{icon:"ri-save-2-line",start:""}),t(z)?M("",!0):(p(),F("span",re,i(t(o)("tools.backup.title")),1))]),_:1}),a(k,{"prepend-icon":"ri-add-line",color:"success",loading:t(C),onClick:R},{default:e(()=>[r(i(t(o)("tools.backup.backup")),1)]),_:1},8,["loading"]),a(k,{"prepend-icon":"ri-delete-bin-5-line",color:"error",disabled:t(f).length===0,loading:t(_),onClick:E},{default:e(()=>[r(i(t(o)("tools.backup.multiDelete")),1)]),_:1},8,["disabled","loading"]),t(z)?M("",!0):(p(),v(k,{key:0,"prepend-icon":"ri-refresh-line",loading:t(h),color:"default",onClick:g},{default:e(()=>[r(i(t(o)("platform.user.table.refresh")),1)]),_:1},8,["loading"]))]),_:1})]),"item.gameName":e(({value:s})=>[a(w,{label:"",color:"primary"},{default:e(()=>[r(i(s),1)]),_:2},1024)]),"item.cycles":e(({value:s})=>[a(w,{label:"",color:"info"},{default:e(()=>[r(i(s),1)]),_:2},1024)]),"item.size":e(({value:s})=>[a(w,{label:"",color:"success"},{default:e(()=>[r(i(t(ee)(s)),1)]),_:2},1024)]),"item.timestamp":e(({value:s})=>[a(w,{label:"",color:"default"},{default:e(()=>[r(i(t(Z)(s)),1)]),_:2},1024)]),"item.actions":e(({item:s})=>[a(k,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:t(c)},{default:e(()=>[r(i(t(o)("tools.backup.actions"))+" ",1),a(ae,{activator:"parent"},{default:e(()=>[a(le,null,{default:e(()=>[a(N,{class:"text-success",onClick:T=>H(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-device-recover-line",size:"22"})]),default:e(()=>[a(S,null,{default:e(()=>[r(i(t(o)("tools.backup.restore")),1)]),_:1})]),_:1},8,["onClick"]),a(N,{class:"text-info",onClick:T=>U(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-download-line",size:"22"})]),default:e(()=>[a(S,null,{default:e(()=>[r(i(t(o)("tools.backup.download")),1)]),_:1})]),_:1},8,["onClick"]),a(N,{class:"text-error",onClick:T=>A(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-delete-bin-line",size:"22"})]),default:e(()=>[a(S,null,{default:e(()=>[r(i(t(o)("tools.backup.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["modelValue","items","loading"])]),_:1})):(p(),v(m,{key:1,title:t(o)("global.noRoomSelected.title"),"sub-title":t(o)("global.noRoomSelected.subTitle"),type:"error",height:D()},{default:e(()=>[a(k,{to:"/rooms",class:"mt-4"},{default:e(()=>[r(i(t(o)("global.noRoomSelected.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(p(),F(q,{key:1},[t(G).userInfo.role==="admin"?(p(),v(m,{key:0,title:t(o)("global.noGame.title"),"sub-title":t(o)("global.noGame.subTitle"),height:D(),type:"error"},{default:e(()=>[a(k,{to:"/install",class:"mt-4"},{default:e(()=>[r(i(t(o)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(p(),v(m,{key:1,title:t(o)("global.noGameNoAdmin.title"),"sub-title":t(o)("global.noGameNoAdmin.subTitle"),height:D(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{xe as default};
